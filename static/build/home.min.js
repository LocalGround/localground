(function(){var t=this,e=t._,i={},n=Array.prototype,r=Object.prototype,s=Function.prototype,o=n.push,a=n.slice,l=n.concat,c=r.toString,h=r.hasOwnProperty,u=n.forEach,d=n.map,f=n.reduce,p=n.reduceRight,g=n.filter,m=n.every,v=n.some,y=n.indexOf,w=n.lastIndexOf,b=Array.isArray,_=Object.keys,x=s.bind,C=function(t){return t instanceof C?t:this instanceof C?void(this._wrapped=t):new C(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=C),exports._=C):t._=C,C.VERSION="1.6.0";var E=C.each=C.forEach=function(t,e,n){if(null==t)return t;if(u&&t.forEach===u)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,s=t.length;s>r;r++)if(e.call(n,t[r],r,t)===i)return}else for(var o=C.keys(t),r=0,s=o.length;s>r;r++)if(e.call(n,t[o[r]],o[r],t)===i)return;return t};C.map=C.collect=function(t,e,i){var n=[];return null==t?n:d&&t.map===d?t.map(e,i):(E(t,function(t,r,s){n.push(e.call(i,t,r,s))}),n)};var S="Reduce of empty array with no initial value";C.reduce=C.foldl=C.inject=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),f&&t.reduce===f)return n&&(e=C.bind(e,n)),r?t.reduce(e,i):t.reduce(e);if(E(t,function(t,s,o){r?i=e.call(n,i,t,s,o):(i=t,r=!0)}),!r)throw new TypeError(S);return i},C.reduceRight=C.foldr=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),p&&t.reduceRight===p)return n&&(e=C.bind(e,n)),r?t.reduceRight(e,i):t.reduceRight(e);var s=t.length;if(s!==+s){var o=C.keys(t);s=o.length}if(E(t,function(a,l,c){l=o?o[--s]:--s,r?i=e.call(n,i,t[l],l,c):(i=t[l],r=!0)}),!r)throw new TypeError(S);return i},C.find=C.detect=function(t,e,i){var n;return M(t,function(t,r,s){return e.call(i,t,r,s)?(n=t,!0):void 0}),n},C.filter=C.select=function(t,e,i){var n=[];return null==t?n:g&&t.filter===g?t.filter(e,i):(E(t,function(t,r,s){e.call(i,t,r,s)&&n.push(t)}),n)},C.reject=function(t,e,i){return C.filter(t,function(t,n,r){return!e.call(i,t,n,r)},i)},C.every=C.all=function(t,e,n){e||(e=C.identity);var r=!0;return null==t?r:m&&t.every===m?t.every(e,n):(E(t,function(t,s,o){return(r=r&&e.call(n,t,s,o))?void 0:i}),!!r)};var M=C.some=C.any=function(t,e,n){e||(e=C.identity);var r=!1;return null==t?r:v&&t.some===v?t.some(e,n):(E(t,function(t,s,o){return r||(r=e.call(n,t,s,o))?i:void 0}),!!r)};C.contains=C.include=function(t,e){return null!=t&&(y&&t.indexOf===y?-1!=t.indexOf(e):M(t,function(t){return t===e}))},C.invoke=function(t,e){var i=a.call(arguments,2),n=C.isFunction(e);return C.map(t,function(t){return(n?e:t[e]).apply(t,i)})},C.pluck=function(t,e){return C.map(t,C.property(e))},C.where=function(t,e){return C.filter(t,C.matches(e))},C.findWhere=function(t,e){return C.find(t,C.matches(e))},C.max=function(t,e,i){if(!e&&C.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);var n=-1/0,r=-1/0;return E(t,function(t,s,o){var a=e?e.call(i,t,s,o):t;a>r&&(n=t,r=a)}),n},C.min=function(t,e,i){if(!e&&C.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);var n=1/0,r=1/0;return E(t,function(t,s,o){var a=e?e.call(i,t,s,o):t;r>a&&(n=t,r=a)}),n},C.shuffle=function(t){var e,i=0,n=[];return E(t,function(t){e=C.random(i++),n[i-1]=n[e],n[e]=t}),n},C.sample=function(t,e,i){return null==e||i?(t.length!==+t.length&&(t=C.values(t)),t[C.random(t.length-1)]):C.shuffle(t).slice(0,Math.max(0,e))};var T=function(t){return null==t?C.identity:C.isFunction(t)?t:C.property(t)};C.sortBy=function(t,e,i){return e=T(e),C.pluck(C.map(t,function(t,n,r){return{value:t,index:n,criteria:e.call(i,t,n,r)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return t.index-e.index}),"value")};var j=function(t){return function(e,i,n){var r={};return i=T(i),E(e,function(s,o){var a=i.call(n,s,o,e);t(r,a,s)}),r}};C.groupBy=j(function(t,e,i){C.has(t,e)?t[e].push(i):t[e]=[i]}),C.indexBy=j(function(t,e,i){t[e]=i}),C.countBy=j(function(t,e){C.has(t,e)?t[e]++:t[e]=1}),C.sortedIndex=function(t,e,i,n){for(var r=(i=T(i)).call(n,e),s=0,o=t.length;o>s;){var a=s+o>>>1;i.call(n,t[a])<r?s=a+1:o=a}return s},C.toArray=function(t){return t?C.isArray(t)?a.call(t):t.length===+t.length?C.map(t,C.identity):C.values(t):[]},C.size=function(t){return null==t?0:t.length===+t.length?t.length:C.keys(t).length},C.first=C.head=C.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:0>e?[]:a.call(t,0,e)},C.initial=function(t,e,i){return a.call(t,0,t.length-(null==e||i?1:e))},C.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},C.rest=C.tail=C.drop=function(t,e,i){return a.call(t,null==e||i?1:e)},C.compact=function(t){return C.filter(t,C.identity)};var P=function(t,e,i){return e&&C.every(t,C.isArray)?l.apply(i,t):(E(t,function(t){C.isArray(t)||C.isArguments(t)?e?o.apply(i,t):P(t,e,i):i.push(t)}),i)};C.flatten=function(t,e){return P(t,e,[])},C.without=function(t){return C.difference(t,a.call(arguments,1))},C.partition=function(t,e){var i=[],n=[];return E(t,function(t){(e(t)?i:n).push(t)}),[i,n]},C.uniq=C.unique=function(t,e,i,n){C.isFunction(e)&&(n=i,i=e,e=!1);var r=i?C.map(t,i,n):t,s=[],o=[];return E(r,function(i,n){(e?n&&o[o.length-1]===i:C.contains(o,i))||(o.push(i),s.push(t[n]))}),s},C.union=function(){return C.uniq(C.flatten(arguments,!0))},C.intersection=function(t){var e=a.call(arguments,1);return C.filter(C.uniq(t),function(t){return C.every(e,function(e){return C.contains(e,t)})})},C.difference=function(t){var e=l.apply(n,a.call(arguments,1));return C.filter(t,function(t){return!C.contains(e,t)})},C.zip=function(){for(var t=C.max(C.pluck(arguments,"length").concat(0)),e=new Array(t),i=0;t>i;i++)e[i]=C.pluck(arguments,""+i);return e},C.object=function(t,e){if(null==t)return{};for(var i={},n=0,r=t.length;r>n;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},C.indexOf=function(t,e,i){if(null==t)return-1;var n=0,r=t.length;if(i){if("number"!=typeof i)return n=C.sortedIndex(t,e),t[n]===e?n:-1;n=0>i?Math.max(0,r+i):i}if(y&&t.indexOf===y)return t.indexOf(e,i);for(;r>n;n++)if(t[n]===e)return n;return-1},C.lastIndexOf=function(t,e,i){if(null==t)return-1;var n=null!=i;if(w&&t.lastIndexOf===w)return n?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var r=n?i:t.length;r--;)if(t[r]===e)return r;return-1},C.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=0,s=new Array(n);n>r;)s[r++]=t,t+=i;return s};var R=function(){};C.bind=function(t,e){var i,n;if(x&&t.bind===x)return x.apply(t,a.call(arguments,1));if(!C.isFunction(t))throw new TypeError;return i=a.call(arguments,2),n=function(){if(!(this instanceof n))return t.apply(e,i.concat(a.call(arguments)));R.prototype=t.prototype;var r=new R;R.prototype=null;var s=t.apply(r,i.concat(a.call(arguments)));return Object(s)===s?s:r}},C.partial=function(t){var e=a.call(arguments,1);return function(){for(var i=0,n=e.slice(),r=0,s=n.length;s>r;r++)n[r]===C&&(n[r]=arguments[i++]);for(;i<arguments.length;)n.push(arguments[i++]);return t.apply(this,n)}},C.bindAll=function(t){var e=a.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return E(e,function(e){t[e]=C.bind(t[e],t)}),t},C.memoize=function(t,e){var i={};return e||(e=C.identity),function(){var n=e.apply(this,arguments);return C.has(i,n)?i[n]:i[n]=t.apply(this,arguments)}},C.delay=function(t,e){var i=a.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},C.defer=function(t){return C.delay.apply(C,[t,1].concat(a.call(arguments,1)))},C.throttle=function(t,e,i){var n,r,s,o=null,a=0;i||(i={});var l=function(){a=!1===i.leading?0:C.now(),o=null,s=t.apply(n,r),n=r=null};return function(){var c=C.now();a||!1!==i.leading||(a=c);var h=e-(c-a);return n=this,r=arguments,0>=h?(clearTimeout(o),o=null,a=c,s=t.apply(n,r),n=r=null):o||!1===i.trailing||(o=setTimeout(l,h)),s}},C.debounce=function(t,e,i){var n,r,s,o,a,l=function(){var c=C.now()-o;e>c?n=setTimeout(l,e-c):(n=null,i||(a=t.apply(s,r),s=r=null))};return function(){s=this,r=arguments,o=C.now();var c=i&&!n;return n||(n=setTimeout(l,e)),c&&(a=t.apply(s,r),s=r=null),a}},C.once=function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}},C.wrap=function(t,e){return C.partial(e,t)},C.compose=function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},C.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},C.keys=function(t){if(!C.isObject(t))return[];if(_)return _(t);var e=[];for(var i in t)C.has(t,i)&&e.push(i);return e},C.values=function(t){for(var e=C.keys(t),i=e.length,n=new Array(i),r=0;i>r;r++)n[r]=t[e[r]];return n},C.pairs=function(t){for(var e=C.keys(t),i=e.length,n=new Array(i),r=0;i>r;r++)n[r]=[e[r],t[e[r]]];return n},C.invert=function(t){for(var e={},i=C.keys(t),n=0,r=i.length;r>n;n++)e[t[i[n]]]=i[n];return e},C.functions=C.methods=function(t){var e=[];for(var i in t)C.isFunction(t[i])&&e.push(i);return e.sort()},C.extend=function(t){return E(a.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t},C.pick=function(t){var e={},i=l.apply(n,a.call(arguments,1));return E(i,function(i){i in t&&(e[i]=t[i])}),e},C.omit=function(t){var e={},i=l.apply(n,a.call(arguments,1));for(var r in t)C.contains(i,r)||(e[r]=t[r]);return e},C.defaults=function(t){return E(a.call(arguments,1),function(e){if(e)for(var i in e)void 0===t[i]&&(t[i]=e[i])}),t},C.clone=function(t){return C.isObject(t)?C.isArray(t)?t.slice():C.extend({},t):t},C.tap=function(t,e){return e(t),t};var k=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof C&&(t=t._wrapped),e instanceof C&&(e=e._wrapped);var r=c.call(t);if(r!=c.call(e))return!1;switch(r){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var s=i.length;s--;)if(i[s]==t)return n[s]==e;var o=t.constructor,a=e.constructor;if(o!==a&&!(C.isFunction(o)&&o instanceof o&&C.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1;i.push(t),n.push(e);var l=0,h=!0;if("[object Array]"==r){if(l=t.length,h=l==e.length)for(;l--&&(h=k(t[l],e[l],i,n)););}else{for(var u in t)if(C.has(t,u)&&(l++,!(h=C.has(e,u)&&k(t[u],e[u],i,n))))break;if(h){for(u in e)if(C.has(e,u)&&!l--)break;h=!l}}return i.pop(),n.pop(),h};C.isEqual=function(t,e){return k(t,e,[],[])},C.isEmpty=function(t){if(null==t)return!0;if(C.isArray(t)||C.isString(t))return 0===t.length;for(var e in t)if(C.has(t,e))return!1;return!0},C.isElement=function(t){return!(!t||1!==t.nodeType)},C.isArray=b||function(t){return"[object Array]"==c.call(t)},C.isObject=function(t){return t===Object(t)},E(["Arguments","Function","String","Number","Date","RegExp"],function(t){C["is"+t]=function(e){return c.call(e)=="[object "+t+"]"}}),C.isArguments(arguments)||(C.isArguments=function(t){return!(!t||!C.has(t,"callee"))}),"function"!=typeof/./&&(C.isFunction=function(t){return"function"==typeof t}),C.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},C.isNaN=function(t){return C.isNumber(t)&&t!=+t},C.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==c.call(t)},C.isNull=function(t){return null===t},C.isUndefined=function(t){return void 0===t},C.has=function(t,e){return h.call(t,e)},C.noConflict=function(){return t._=e,this},C.identity=function(t){return t},C.constant=function(t){return function(){return t}},C.property=function(t){return function(e){return e[t]}},C.matches=function(t){return function(e){if(e===t)return!0;for(var i in t)if(t[i]!==e[i])return!1;return!0}},C.times=function(t,e,i){for(var n=Array(Math.max(0,t)),r=0;t>r;r++)n[r]=e.call(i,r);return n},C.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},C.now=Date.now||function(){return(new Date).getTime()};var O={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};O.unescape=C.invert(O.escape);var V={escape:new RegExp("["+C.keys(O.escape).join("")+"]","g"),unescape:new RegExp("("+C.keys(O.unescape).join("|")+")","g")};C.each(["escape","unescape"],function(t){C[t]=function(e){return null==e?"":(""+e).replace(V[t],function(e){return O[t][e]})}}),C.result=function(t,e){if(null!=t){var i=t[e];return C.isFunction(i)?i.call(t):i}},C.mixin=function(t){E(C.functions(t),function(e){var i=C[e]=t[e];C.prototype[e]=function(){var t=[this._wrapped];return o.apply(t,arguments),I.call(this,i.apply(C,t))}})};var F=0;C.uniqueId=function(t){var e=++F+"";return t?t+e:e},C.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var A=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;C.template=function(t,e,i){var n;i=C.defaults({},i,C.templateSettings);var r=new RegExp([(i.escape||A).source,(i.interpolate||A).source,(i.evaluate||A).source].join("|")+"|$","g"),s=0,o="__p+='";t.replace(r,function(e,i,n,r,a){return o+=t.slice(s,a).replace(B,function(t){return"\\"+N[t]}),i&&(o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(o+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),r&&(o+="';\n"+r+"\n__p+='"),s=a+e.length,e}),o+="';\n",i.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{n=new Function(i.variable||"obj","_",o)}catch(t){throw t.source=o,t}if(e)return n(e,C);var a=function(t){return n.call(this,t,C)};return a.source="function("+(i.variable||"obj")+"){\n"+o+"}",a},C.chain=function(t){return C(t).chain()};var I=function(t){return this._chain?C(t).chain():t};C.mixin(C),E(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];C.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!=t&&"splice"!=t||0!==i.length||delete i[0],I.call(this,i)}}),E(["concat","join","slice"],function(t){var e=n[t];C.prototype[t]=function(){return I.call(this,e.apply(this._wrapped,arguments))}}),C.extend(C.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return C})}).call(this),function(t,e){if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(i,n,r){t.Backbone=e(t,r,i,n)});else if("undefined"!=typeof exports){var i=require("underscore");e(t,exports,i)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(this,function(t,e,i,n){var r=t.Backbone,s=[],o=s.slice;e.VERSION="1.1.2",e.$=n,e.noConflict=function(){return t.Backbone=r,this},e.emulateHTTP=!1,e.emulateJSON=!1;var a=e.Events={on:function(t,e,i){return c(this,"on",t,[e,i])&&e?(this._events||(this._events={}),(this._events[t]||(this._events[t]=[])).push({callback:e,context:i,ctx:i||this}),this):this},once:function(t,e,n){if(!c(this,"once",t,[e,n])||!e)return this;var r=this,s=i.once(function(){r.off(t,s),e.apply(this,arguments)});return s._callback=e,this.on(t,s,n)},off:function(t,e,n){var r,s,o,a,l,h,u,d;if(!this._events||!c(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events=void 0,this;for(l=0,h=(a=t?[t]:i.keys(this._events)).length;l<h;l++)if(t=a[l],o=this._events[t]){if(this._events[t]=r=[],e||n)for(u=0,d=o.length;u<d;u++)s=o[u],(e&&e!==s.callback&&e!==s.callback._callback||n&&n!==s.context)&&r.push(s);r.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=o.call(arguments,1);if(!c(this,"trigger",t,e))return this;var i=this._events[t],n=this._events.all;return i&&h(i,e),n&&h(n,arguments),this},stopListening:function(t,e,n){var r=this._listeningTo;if(!r)return this;var s=!e&&!n;n||"object"!=typeof e||(n=this),t&&((r={})[t._listenId]=t);for(var o in r)(t=r[o]).off(e,n,this),(s||i.isEmpty(t._events))&&delete this._listeningTo[o];return this}},l=/\s+/,c=function(t,e,i,n){if(!i)return!0;if("object"==typeof i){for(var r in i)t[e].apply(t,[r,i[r]].concat(n));return!1}if(l.test(i)){for(var s=i.split(l),o=0,a=s.length;o<a;o++)t[e].apply(t,[s[o]].concat(n));return!1}return!0},h=function(t,e){var i,n=-1,r=t.length,s=e[0],o=e[1],a=e[2];switch(e.length){case 0:for(;++n<r;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s);return;case 2:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s,o);return;case 3:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s,o,a);return;default:for(;++n<r;)(i=t[n]).callback.apply(i.ctx,e);return}},u={listenTo:"on",listenToOnce:"once"};i.each(u,function(t,e){a[e]=function(e,n,r){return(this._listeningTo||(this._listeningTo={}))[e._listenId||(e._listenId=i.uniqueId("l"))]=e,r||"object"!=typeof n||(r=this),e[t](n,r,this),this}}),a.bind=a.on,a.unbind=a.off,i.extend(e,a);var d=e.Model=function(t,e){var n=t||{};e||(e={}),this.cid=i.uniqueId("c"),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{}),n=i.defaults({},n,i.result(this,"defaults")),this.set(n,e),this.changed={},this.initialize.apply(this,arguments)};i.extend(d.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(t){return i.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return i.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,n){var r,s,o,a,l,c,h,u;if(null==t)return this;if("object"==typeof t?(s=t,n=e):(s={})[t]=e,n||(n={}),!this._validate(s,n))return!1;o=n.unset,l=n.silent,a=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=i.clone(this.attributes),this.changed={}),u=this.attributes,h=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(r in s)e=s[r],i.isEqual(u[r],e)||a.push(r),i.isEqual(h[r],e)?delete this.changed[r]:this.changed[r]=e,o?delete u[r]:u[r]=e;if(!l){a.length&&(this._pending=n);for(var d=0,f=a.length;d<f;d++)this.trigger("change:"+a[d],this,u[a[d]],n)}if(c)return this;if(!l)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,i.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!i.isEmpty(this.changed):i.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&i.clone(this.changed);var e,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var s in t)i.isEqual(r[s],e=t[s])||((n||(n={}))[s]=e);return n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(t){void 0===(t=t?i.clone(t):{}).parse&&(t.parse=!0);var e=this,n=t.success;return t.success=function(i){if(!e.set(e.parse(i,t),t))return!1;n&&n(e,i,t),e.trigger("sync",e,i,t)},N(this,t),this.sync("read",this,t)},save:function(t,e,n){var r,s,o,a=this.attributes;if(null==t||"object"==typeof t?(r=t,n=e):(r={})[t]=e,n=i.extend({validate:!0},n),r&&!n.wait){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=i.extend({},a,r)),void 0===n.parse&&(n.parse=!0);var l=this,c=n.success;return n.success=function(t){l.attributes=a;var e=l.parse(t,n);if(n.wait&&(e=i.extend(r||{},e)),i.isObject(e)&&!l.set(e,n))return!1;c&&c(l,t,n),l.trigger("sync",l,t,n)},N(this,n),"patch"===(s=this.isNew()?"create":n.patch?"patch":"update")&&(n.attrs=r),o=this.sync(s,this,n),r&&n.wait&&(this.attributes=a),o},destroy:function(t){var e=this,n=(t=t?i.clone(t):{}).success,r=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(i){(t.wait||e.isNew())&&r(),n&&n(e,i,t),e.isNew()||e.trigger("sync",e,i,t)},this.isNew())return t.success(),!1;N(this,t);var s=this.sync("delete",this,t);return t.wait||r(),s},url:function(){var t=i.result(this,"urlRoot")||i.result(this.collection,"url")||A();return this.isNew()?t:t.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=i.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return!n||(this.trigger("invalid",this,n,i.extend(e,{validationError:n})),!1)}});var f=["keys","values","pairs","invert","pick","omit"];i.each(f,function(t){d.prototype[t]=function(){var e=o.call(arguments);return e.unshift(this.attributes),i[t].apply(i,e)}});var p=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,i.extend({silent:!0},e))},g={add:!0,remove:!0,merge:!0},m={add:!0,remove:!1};i.extend(p.prototype,a,{model:d,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,i.extend({merge:!1},e,m))},remove:function(t,e){var n=!i.isArray(t);t=n?[t]:i.clone(t),e||(e={});var r,s,o,a;for(r=0,s=t.length;r<s;r++)(a=t[r]=this.get(t[r]))&&(delete this._byId[a.id],delete this._byId[a.cid],o=this.indexOf(a),this.models.splice(o,1),this.length--,e.silent||(e.index=o,a.trigger("remove",a,this,e)),this._removeReference(a,e));return n?t[0]:t},set:function(t,e){(e=i.defaults({},e,g)).parse&&(t=this.parse(t,e));var n=!i.isArray(t);t=n?t?[t]:[]:i.clone(t);var r,s,o,a,l,c,h,u=e.at,f=this.model,p=this.comparator&&null==u&&!1!==e.sort,m=i.isString(this.comparator)?this.comparator:null,v=[],y=[],w={},b=e.add,_=e.merge,x=e.remove,C=!(p||!b||!x)&&[];for(r=0,s=t.length;r<s;r++){if(l=t[r]||{},o=l instanceof d?a=l:l[f.prototype.idAttribute||"id"],c=this.get(o))x&&(w[c.cid]=!0),_&&(l=l===a?a.attributes:l,e.parse&&(l=c.parse(l,e)),c.set(l,e),p&&!h&&c.hasChanged(m)&&(h=!0)),t[r]=c;else if(b){if(!(a=t[r]=this._prepareModel(l,e)))continue;v.push(a),this._addReference(a,e)}a=c||a,!C||!a.isNew()&&w[a.id]||C.push(a),w[a.id]=!0}if(x){for(r=0,s=this.length;r<s;++r)w[(a=this.models[r]).cid]||y.push(a);y.length&&this.remove(y,e)}if(v.length||C&&C.length)if(p&&(h=!0),this.length+=v.length,null!=u)for(r=0,s=v.length;r<s;r++)this.models.splice(u+r,0,v[r]);else{C&&(this.models.length=0);var E=C||v;for(r=0,s=E.length;r<s;r++)this.models.push(E[r])}if(h&&this.sort({silent:!0}),!e.silent){for(r=0,s=v.length;r<s;r++)(a=v[r]).trigger("add",a,this,e);(h||C&&C.length)&&this.trigger("sort",this,e)}return n?t[0]:t},reset:function(t,e){e||(e={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n],e);return e.previousModels=this.models,this._reset(),t=this.add(t,i.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,i.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return o.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[t.id]||this._byId[t.cid]},at:function(t){return this.models[t]},where:function(t,e){return i.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),i.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(i.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return i.invoke(this.models,"get",t)},fetch:function(t){void 0===(t=t?i.clone(t):{}).parse&&(t.parse=!0);var e=t.success,n=this;return t.success=function(i){var r=t.reset?"reset":"set";n[r](i,t),e&&e(n,i,t),n.trigger("sync",n,i,t)},N(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?i.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var n=this,r=e.success;return e.success=function(t,i){e.wait&&n.add(t,e),r&&r(t,i,e)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof d)return t;(e=e?i.clone(e):{}).collection=this;var n=new this.model(t,e);return n.validationError?(this.trigger("invalid",this,n.validationError,e),!1):n},_addReference:function(t,e){this._byId[t.cid]=t,null!=t.id&&(this._byId[t.id]=t),t.collection||(t.collection=this),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){("add"!==t&&"remove"!==t||i===this)&&("destroy"===t&&this.remove(e,n),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var v=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];i.each(v,function(t){p.prototype[t]=function(){var e=o.call(arguments);return e.unshift(this.models),i[t].apply(i,e)}});var y=["groupBy","countBy","sortBy","indexBy"];i.each(y,function(t){p.prototype[t]=function(e,n){var r=i.isFunction(e)?e:function(t){return t.get(e)};return i[t](this.models,r,n)}});var w=e.View=function(t){this.cid=i.uniqueId("view"),t||(t={}),i.extend(this,i.pick(t,_)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,_=["model","collection","el","id","attributes","className","tagName","events"];i.extend(w.prototype,a,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,i){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],!1!==i&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=i.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var n=t[e];if(i.isFunction(n)||(n=this[t[e]]),n){var r=e.match(b),s=r[1],o=r[2];n=i.bind(n,this),s+=".delegateEvents"+this.cid,""===o?this.$el.on(s,n):this.$el.on(s,o,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"),!1);else{var t=i.extend({},i.result(this,"attributes"));this.id&&(t.id=i.result(this,"id")),this.className&&(t.class=i.result(this,"className"));var n=e.$("<"+i.result(this,"tagName")+">").attr(t);this.setElement(n,!1)}}}),e.sync=function(t,n,r){var s=C[t];i.defaults(r||(r={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var o={type:s,dataType:"json"};if(r.url||(o.url=i.result(n,"url")||A()),null!=r.data||!n||"create"!==t&&"update"!==t&&"patch"!==t||(o.contentType="application/json",o.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),r.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){o.type="POST",r.emulateJSON&&(o.data._method=s);var a=r.beforeSend;r.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",s),a)return a.apply(this,arguments)}}"GET"===o.type||r.emulateJSON||(o.processData=!1),"PATCH"===o.type&&x&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=r.xhr=e.ajax(i.extend(o,r));return n.trigger("request",n,l,r),l};var x=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),C={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var E=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},S=/\((.*?)\)/g,M=/(\(\?)?:\w+/g,T=/\*\w+/g,j=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(E.prototype,a,{initialize:function(){},route:function(t,n,r){i.isRegExp(t)||(t=this._routeToRegExp(t)),i.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var s=this;return e.history.route(t,function(i){var o=s._extractParameters(t,i);s.execute(r,o),s.trigger.apply(s,["route:"+n].concat(o)),s.trigger("route",n,o),e.history.trigger("route",s,n,o)}),this},execute:function(t,e){t&&t.apply(this,e)},navigate:function(t,i){return e.history.navigate(t,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var t,e=i.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(j,"\\$&").replace(S,"(?:$1)?").replace(M,function(t,e){return e?t:"([^/?]+)"}).replace(T,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return i.map(n,function(t,e){return e===n.length-1?t||null:t?decodeURIComponent(t):null})}});var P=e.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},R=/^[#\/]|\s+$/g,k=/^\/+|\/+$/g,O=/msie [\w.]+/,V=/\/$/,F=/#.*$/;P.started=!1,i.extend(P.prototype,a,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=decodeURI(this.location.pathname+this.location.search);var i=this.root.replace(V,"");t.indexOf(i)||(t=t.slice(i.length))}else t=this.getHash();return t.replace(R,"")},start:function(t){if(P.started)throw new Error("Backbone.history has already been started");P.started=!0,this.options=i.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),r=document.documentMode,s=O.exec(navigator.userAgent.toLowerCase())&&(!r||r<=7);if(this.root=("/"+this.root+"/").replace(k,"/"),s&&this._wantsHashChange){var o=e.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=o.hide().appendTo("body")[0].contentWindow,this.navigate(n)}this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var a=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&a.hash&&(this.fragment=this.getHash().replace(R,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),P.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(t){return t=this.fragment=this.getFragment(t),i.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0})},navigate:function(t,e){if(!P.started)return!1;e&&!0!==e||(e={trigger:!!e});var i=this.root+(t=this.getFragment(t||""));if(t=t.replace(F,""),this.fragment!==t){if(this.fragment=t,""===t&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),e.history=new P;d.extend=p.extend=E.extend=w.extend=P.extend=function(t,e){var n,r=this;n=t&&i.has(t,"constructor")?t.constructor:function(){return r.apply(this,arguments)},i.extend(n,r,e);var s=function(){this.constructor=n};return s.prototype=r.prototype,n.prototype=new s,t&&i.extend(n.prototype,t),n.__super__=r.prototype,n};var A=function(){throw new Error('A "url" property or function must be specified')},N=function(t,e){var i=e.error;e.error=function(n){i&&i(t,n,e),t.trigger("error",t,n,e)}};return e}),function(t,e){if("function"==typeof define&&define.amd)define("marionette",["backbone","underscore"],function(i,n){return t.Marionette=e(t,i,n)});else if("undefined"!=typeof exports){var i=require("backbone"),n=require("underscore");module.exports=e(t,i,n)}else t.Marionette=e(t,t.Backbone,t._)}(this,function(t,e,i){"use strict";!function(t,e){var i=t.ChildViewContainer;t.ChildViewContainer=function(t,e){var i=function(t){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),e.each(t,this.add,this)};e.extend(i.prototype,{add:function(t,e){var i=t.cid;return this._views[i]=t,t.model&&(this._indexByModel[t.model.cid]=i),e&&(this._indexByCustom[e]=i),this._updateLength(),this},findByModel:function(t){return this.findByModelCid(t.cid)},findByModelCid:function(t){var e=this._indexByModel[t];return this.findByCid(e)},findByCustom:function(t){var e=this._indexByCustom[t];return this.findByCid(e)},findByIndex:function(t){return e.values(this._views)[t]},findByCid:function(t){return this._views[t]},remove:function(t){var i=t.cid;return t.model&&delete this._indexByModel[t.model.cid],e.any(this._indexByCustom,function(t,e){if(t===i)return delete this._indexByCustom[e],!0},this),delete this._views[i],this._updateLength(),this},call:function(t){this.apply(t,e.tail(arguments))},apply:function(t,i){e.each(this._views,function(n){e.isFunction(n[t])&&n[t].apply(n,i||[])})},_updateLength:function(){this.length=e.size(this._views)}});var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return e.each(n,function(t){i.prototype[t]=function(){var i=[e.values(this._views)].concat(e.toArray(arguments));return e[t].apply(e,i)}}),i}(0,e),t.ChildViewContainer.VERSION="0.1.4",t.ChildViewContainer.noConflict=function(){return t.ChildViewContainer=i,this},t.ChildViewContainer}(e,i),function(t,e){var i=t.Wreqr,n=t.Wreqr={};t.Wreqr.VERSION="1.3.1",t.Wreqr.noConflict=function(){return t.Wreqr=i,this},n.Handlers=function(t,e){var i=function(t){this.options=t,this._wreqrHandlers={},e.isFunction(this.initialize)&&this.initialize(t)};return i.extend=t.Model.extend,e.extend(i.prototype,t.Events,{setHandlers:function(t){e.each(t,function(t,i){var n=null;e.isObject(t)&&!e.isFunction(t)&&(n=t.context,t=t.callback),this.setHandler(i,t,n)},this)},setHandler:function(t,e,i){var n={callback:e,context:i};this._wreqrHandlers[t]=n,this.trigger("handler:add",t,e,i)},hasHandler:function(t){return!!this._wreqrHandlers[t]},getHandler:function(t){var e=this._wreqrHandlers[t];if(e)return function(){var t=Array.prototype.slice.apply(arguments);return e.callback.apply(e.context,t)}},removeHandler:function(t){delete this._wreqrHandlers[t]},removeAllHandlers:function(){this._wreqrHandlers={}}}),i}(t,e),n.CommandStorage=function(){var i=function(t){this.options=t,this._commands={},e.isFunction(this.initialize)&&this.initialize(t)};return e.extend(i.prototype,t.Events,{getCommands:function(t){var e=this._commands[t];return e||(e={command:t,instances:[]},this._commands[t]=e),e},addCommand:function(t,e){this.getCommands(t).instances.push(e)},clearCommands:function(t){this.getCommands(t).instances=[]}}),i}(),n.Commands=function(t){return t.Handlers.extend({storageType:t.CommandStorage,constructor:function(e){this.options=e||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var i=Array.prototype.slice.call(arguments);t.Handlers.prototype.constructor.apply(this,i)},execute:function(t,e){t=arguments[0],e=Array.prototype.slice.call(arguments,1),this.hasHandler(t)?this.getHandler(t).apply(this,e):this.storage.addCommand(t,e)},_executeCommands:function(t,i,n){var r=this.storage.getCommands(t);e.each(r.instances,function(t){i.apply(n,t)}),this.storage.clearCommands(t)},_initializeStorage:function(t){var i,n=t.storageType||this.storageType;i=e.isFunction(n)?new n:n,this.storage=i}})}(n),n.RequestResponse=function(t){return t.Handlers.extend({request:function(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);if(this.hasHandler(t))return this.getHandler(t).apply(this,e)}})}(n),n.EventAggregator=function(t,e){var i=function(){};return i.extend=t.Model.extend,e.extend(i.prototype,t.Events),i}(t,e),n.Channel=function(i){var n=function(e){this.vent=new t.Wreqr.EventAggregator,this.reqres=new t.Wreqr.RequestResponse,this.commands=new t.Wreqr.Commands,this.channelName=e};return e.extend(n.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(t,e){return this._connect("vent",t,e),this},connectCommands:function(t,e){return this._connect("commands",t,e),this},connectRequests:function(t,e){return this._connect("reqres",t,e),this},_connect:function(t,i,n){if(i){n=n||this;var r="vent"===t?"on":"setHandler";e.each(i,function(i,s){this[t][r](s,e.bind(i,n))},this)}}}),n}(),n.radio=function(t){var i=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};e.extend(i.prototype,{channel:function(t){if(!t)throw new Error("Channel must receive a name");return this._getChannel(t)},_getChannel:function(e){var i=this._channels[e];return i||(i=new t.Channel(e),this._channels[e]=i),i},_proxyMethods:function(){e.each(["vent","commands","reqres"],function(t){e.each(n[t],function(e){this[t][e]=r(this,t,e)},this)},this)}});var n={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},r=function(t,e,i){return function(n){var r=t._getChannel(n)[e],s=Array.prototype.slice.call(arguments,1);return r[i].apply(r,s)}};return new i}(n),t.Wreqr}(e,i);var n=t.Marionette,r=e.Marionette={};r.VERSION="2.2.0",r.noConflict=function(){return t.Marionette=n,this},e.Marionette=r,r.Deferred=e.$.Deferred;var s=Array.prototype.slice;r.extend=e.Model.extend,r.getOption=function(t,e){if(t&&e){return t.options&&void 0!==t.options[e]?t.options[e]:t[e]}},r.proxyGetOption=function(t){return r.getOption(this,t)},r.normalizeMethods=function(t){var e={};return i.each(t,function(t,n){i.isFunction(t)||(t=this[t]),t&&(e[n]=t)},this),e},r.normalizeUIString=function(t,e){return t.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(t){return e[t.slice(4)]})},r.normalizeUIKeys=function(t,e){if(void 0!==t)return t=i.clone(t),i.each(i.keys(t),function(i){var n=r.normalizeUIString(i,e);n!==i&&(t[n]=t[i],delete t[i])}),t},r.normalizeUIValues=function(t,e){if(void 0!==t)return i.each(t,function(n,s){i.isString(n)&&(t[s]=r.normalizeUIString(n,e))}),t},r.actAsCollection=function(t,e){var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];i.each(n,function(n){t[n]=function(){var t=[i.values(i.result(this,e))].concat(i.toArray(arguments));return i[n].apply(i,t)}})},r.triggerMethod=function(t){var e,n=/(^|:)(\w)/gi,r=this["on"+t.replace(n,function(t,e,i){return i.toUpperCase()})];return i.isFunction(r)&&(e=r.apply(this,i.tail(arguments))),i.isFunction(this.trigger)&&this.trigger.apply(this,arguments),e},r.triggerMethodOn=function(t,e){var n=i.tail(arguments,2);return(i.isFunction(t.triggerMethod)?t.triggerMethod:r.triggerMethod).apply(t,[e].concat(n))},r.MonitorDOMRefresh=function(t){function n(t){t._isShown=!0,s(t)}function r(t){t._isRendered=!0,s(t)}function s(t){t._isShown&&t._isRendered&&o(t)&&i.isFunction(t.triggerMethod)&&t.triggerMethod("dom:refresh")}function o(i){return e.$.contains(t,i.el)}return function(t){t.listenTo(t,"show",function(){n(t)}),t.listenTo(t,"render",function(){r(t)})}}(document.documentElement),function(t){function e(e,n,r,s){var o=s.split(/\s+/);i.each(o,function(i){var s=e[i];if(!s)throw new t.Error('Method "'+i+'" was configured as an event handler, but does not exist.');e.listenTo(n,r,s)})}function n(t,e,i,n){t.listenTo(e,i,n)}function r(t,e,n,r){var s=r.split(/\s+/);i.each(s,function(i){var r=t[i];t.stopListening(e,n,r)})}function s(t,e,i,n){t.stopListening(e,i,n)}function o(e,n,r,s,o){if(n&&r){if(!i.isFunction(r)&&!i.isObject(r))throw new t.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});i.isFunction(r)&&(r=r.call(e)),i.each(r,function(t,r){i.isFunction(t)?s(e,n,r,t):o(e,n,r,t)})}}t.bindEntityEvents=function(t,i,r){o(t,i,r,n,e)},t.unbindEntityEvents=function(t,e,i){o(t,e,i,s,r)},t.proxyBindEntityEvents=function(e,i){return t.bindEntityEvents(this,e,i)},t.proxyUnbindEntityEvents=function(e,i){return t.unbindEntityEvents(this,e,i)}}(r);var o=["description","fileName","lineNumber","name","message","number"];return r.Error=r.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/"+r.VERSION+"/",constructor:function(t,e){i.isObject(t)?t=(e=t).message:e||(e={});var n=Error.call(this,t);i.extend(this,i.pick(n,o),i.pick(e,o)),this.captureStackTrace(),e.url&&(this.url=this.urlRoot+e.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,r.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),r.Error.extend=r.extend,r.Callbacks=function(){this._deferred=r.Deferred(),this._callbacks=[]},i.extend(r.Callbacks.prototype,{add:function(t,e){var n=i.result(this._deferred,"promise");this._callbacks.push({cb:t,ctx:e}),n.then(function(i){e&&(i.context=e),t.call(i.context,i.options)})},run:function(t,e){this._deferred.resolve({options:t,context:e})},reset:function(){var t=this._callbacks;this._deferred=r.Deferred(),this._callbacks=[],i.each(t,function(t){this.add(t.cb,t.ctx)},this)}}),r.Controller=function(t){this.options=t||{},i.isFunction(this.initialize)&&this.initialize(this.options)},r.Controller.extend=r.extend,i.extend(r.Controller.prototype,e.Events,{destroy:function(){var t=s.call(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(t)),this.triggerMethod.apply(this,["destroy"].concat(t)),this.stopListening(),this.off(),this},triggerMethod:r.triggerMethod,getOption:r.proxyGetOption}),r.Object=function(t){this.options=i.extend({},i.result(this,"options"),t),this.initialize.apply(this,arguments)},r.Object.extend=r.extend,i.extend(r.Object.prototype,{initialize:function(){},destroy:function(){this.triggerMethod("before:destroy"),this.triggerMethod("destroy"),this.stopListening()},triggerMethod:r.triggerMethod,getOption:r.proxyGetOption,bindEntityEvents:r.proxyBindEntityEvents,unbindEntityEvents:r.proxyUnbindEntityEvents}),i.extend(r.Object.prototype,e.Events),r.Region=function(t){if(this.options=t||{},this.el=this.getOption("el"),this.el=this.el instanceof e.$?this.el[0]:this.el,!this.el)throw new r.Error({name:"NoElError",message:'An "el" must be specified for a region.'});if(this.$el=this.getEl(this.el),this.initialize){var i=s.apply(arguments);this.initialize.apply(this,i)}},i.extend(r.Region,{buildRegion:function(t,e){if(i.isString(t))return this._buildRegionFromSelector(t,e);if(t.selector||t.el||t.regionClass)return this._buildRegionFromObject(t,e);if(i.isFunction(t))return this._buildRegionFromRegionClass(t);throw new r.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(t,e){return new e({el:t})},_buildRegionFromObject:function(t,n){var r=t.regionClass||n,s=i.omit(t,"selector","regionClass");t.selector&&!s.el&&(s.el=t.selector);var o=new r(s);return t.parentEl&&(o.getEl=function(n){if(i.isObject(n))return e.$(n);var r=t.parentEl;return i.isFunction(r)&&(r=r()),r.find(n)}),o},_buildRegionFromRegionClass:function(t){return new t}}),i.extend(r.Region.prototype,e.Events,{show:function(t,e){this._ensureElement();var n=e||{},s=t!==this.currentView,o=!!n.preventDestroy,a=!!n.forceShow,l=!!this.currentView,c=!o&&s,h=s||a;return l&&this.triggerMethod("before:swapOut",this.currentView),c&&this.empty(),h?(t.once("destroy",i.bind(this.empty,this)),t.render(),l&&this.triggerMethod("before:swap",t),this.triggerMethod("before:show",t),r.triggerMethodOn(t,"before:show"),l&&this.triggerMethod("swapOut",this.currentView),this.attachHtml(t),this.currentView=t,l&&this.triggerMethod("swap",t),this.triggerMethod("show",t),r.triggerMethodOn(t,"show"),this):this},_ensureElement:function(){if(i.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length)throw new r.Error('An "el" '+this.$el.selector+" must exist in DOM")},getEl:function(t){return e.$(t)},attachHtml:function(t){this.el.innerHTML="",this.el.appendChild(t.el)},empty:function(){var t=this.currentView;if(t)return this.triggerMethod("before:empty",t),this._destroyView(),this.triggerMethod("empty",t),delete this.currentView,this},_destroyView:function(){var t=this.currentView;t.destroy&&!t.isDestroyed?t.destroy():t.remove&&t.remove()},attachView:function(t){return this.currentView=t,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this},getOption:r.proxyGetOption,triggerMethod:r.triggerMethod}),r.Region.extend=r.extend,r.RegionManager=function(t){var e=t.Controller.extend({constructor:function(e){this._regions={},t.Controller.call(this,e)},addRegions:function(t,e){i.isFunction(t)&&(t=t.apply(this,arguments));var n={};return i.each(t,function(t,r){i.isString(t)&&(t={selector:t}),t.selector&&(t=i.defaults({},t,e));var s=this.addRegion(r,t);n[r]=s},this),n},addRegion:function(e,i){var n;return n=i instanceof t.Region?i:t.Region.buildRegion(i,t.Region),this.triggerMethod("before:add:region",e,n),this._store(e,n),this.triggerMethod("add:region",e,n),n},get:function(t){return this._regions[t]},getRegions:function(){return i.clone(this._regions)},removeRegion:function(t){var e=this._regions[t];return this._remove(t,e),e},removeRegions:function(){var t=this.getRegions();return i.each(this._regions,function(t,e){this._remove(e,t)},this),t},emptyRegions:function(){var t=this.getRegions();return i.each(t,function(t){t.empty()},this),t},destroy:function(){return this.removeRegions(),t.Controller.prototype.destroy.apply(this,arguments)},_store:function(t,e){this._regions[t]=e,this._setLength()},_remove:function(t,e){this.triggerMethod("before:remove:region",t,e),e.empty(),e.stopListening(),delete this._regions[t],this._setLength(),this.triggerMethod("remove:region",t,e)},_setLength:function(){this.length=i.size(this._regions)}});return t.actAsCollection(e.prototype,"_regions"),e}(r),r.TemplateCache=function(t){this.templateId=t},i.extend(r.TemplateCache,{templateCaches:{},get:function(t){var e=this.templateCaches[t];return e||(e=new r.TemplateCache(t),this.templateCaches[t]=e),e.load()},clear:function(){var t,e=s.call(arguments),i=e.length;if(i>0)for(t=0;t<i;t++)delete this.templateCaches[e[t]];else this.templateCaches={}}}),i.extend(r.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(t),this.compiledTemplate},loadTemplate:function(t){var i=e.$(t).html();if(!i||0===i.length)throw new r.Error({name:"NoTemplateError",message:'Could not find template: "'+t+'"'});return i},compileTemplate:function(t){return i.template(t)}}),r.Renderer={render:function(t,e){if(!t)throw new r.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});return("function"==typeof t?t:r.TemplateCache.get(t))(e)}},r.View=e.View.extend({constructor:function(t){i.bindAll(this,"render"),this.options=i.extend({},i.result(this,"options"),i.isFunction(t)?t.call(this):t),this._behaviors=r.Behaviors(this),e.View.apply(this,arguments),r.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled)},getTemplate:function(){return this.getOption("template")},serializeModel:function(t){return t.toJSON.apply(t,s.call(arguments,1))},mixinTemplateHelpers:function(t){t=t||{};var e=this.getOption("templateHelpers");return i.isFunction(e)&&(e=e.call(this)),i.extend(t,e)},normalizeUIKeys:function(t){var e=i.result(this,"ui"),n=i.result(this,"_uiBindings");return r.normalizeUIKeys(t,n||e)},normalizeUIValues:function(t){var e=i.result(this,"ui"),n=i.result(this,"_uiBindings");return r.normalizeUIValues(t,n||e)},configureTriggers:function(){if(this.triggers){var t={},e=this.normalizeUIKeys(i.result(this,"triggers"));return i.each(e,function(e,i){t[i]=this._buildViewTrigger(e)},this),t}},delegateEvents:function(t){return this._delegateDOMEvents(t),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),i.each(this._behaviors,function(t){t.bindEntityEvents(this.model,t.getOption("modelEvents")),t.bindEntityEvents(this.collection,t.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(t){var n=t||this.events;i.isFunction(n)&&(n=n.call(this)),n=this.normalizeUIKeys(n),i.isUndefined(t)&&(this.events=n);var r={},s=i.result(this,"behaviorEvents")||{},o=this.configureTriggers(),a=i.result(this,"behaviorTriggers")||{};i.extend(r,s,n,o,a),e.View.prototype.delegateEvents.call(this,r)},undelegateEvents:function(){var t=s.call(arguments);return e.View.prototype.undelegateEvents.apply(this,t),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),i.each(this._behaviors,function(t){t.unbindEntityEvents(this.model,t.getOption("modelEvents")),t.unbindEntityEvents(this.collection,t.getOption("collectionEvents"))},this),this},onShowCalled:function(){},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new r.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(!this.isDestroyed){var t=s.call(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(t)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(t)),this.unbindUIElements(),this.remove(),i.invoke(this._behaviors,"destroy",t),this}},bindUIElements:function(){this._bindUIElements(),i.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var t=i.result(this,"_uiBindings");this.ui={},i.each(i.keys(t),function(e){var i=t[e];this.ui[e]=this.$(i)},this)}},unbindUIElements:function(){this._unbindUIElements(),i.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(i.each(this.ui,function(t,e){delete this.ui[e]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(t){var e=i.isObject(t),n=i.defaults({},e?t:{},{preventDefault:!0,stopPropagation:!0}),r=e?n.event:t;return function(t){t&&(t.preventDefault&&n.preventDefault&&t.preventDefault(),t.stopPropagation&&n.stopPropagation&&t.stopPropagation());var e={view:this,model:this.model,collection:this.collection};this.triggerMethod(r,e)}},setElement:function(){var t=e.View.prototype.setElement.apply(this,arguments);return i.invoke(this._behaviors,"proxyViewProperties",this),t},triggerMethod:function(){var t=arguments,e=r.triggerMethod,n=e.apply(this,t);return i.each(this._behaviors,function(i){e.apply(i,t)}),n},normalizeMethods:r.normalizeMethods,getOption:r.proxyGetOption,bindEntityEvents:r.proxyBindEntityEvents,unbindEntityEvents:r.proxyUnbindEntityEvents}),r.ItemView=r.View.extend({constructor:function(){r.View.apply(this,arguments)},serializeData:function(){var t={};return this.model?t=i.partial(this.serializeModel,this.model).apply(this,arguments):this.collection&&(t={items:i.partial(this.serializeCollection,this.collection).apply(this,arguments)}),t},serializeCollection:function(t){return t.toJSON.apply(t,s.call(arguments,1))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var t=this.getTemplate();if(!1!==t){if(!t)throw new r.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var e=this.serializeData();e=this.mixinTemplateHelpers(e);var i=r.Renderer.render(t,e,this);return this.attachElContent(i),this}},attachElContent:function(t){return this.$el.html(t),this},destroy:function(){if(!this.isDestroyed)return r.View.prototype.destroy.apply(this,arguments)}}),r.CollectionView=r.View.extend({childViewEventPrefix:"childview",constructor:function(t){var n=t||{};if(this.sort=!!i.isUndefined(n.sort)||n.sort,n.collection&&!(n.collection instanceof e.Collection))throw new r.Error("The Collection option passed to this view needs to be an instance of a Backbone.Collection");this.once("render",this._initialEvents),this._initChildViewStorage(),r.View.apply(this,arguments),this.initRenderBuffer()},initRenderBuffer:function(){this.elBuffer=document.createDocumentFragment(),this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this._triggerBeforeShowBufferedChildren(),this.attachBuffer(this,this.elBuffer),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerBeforeShowBufferedChildren:function(){this._isShown&&i.each(this._bufferedChildren,i.partial(this._triggerMethodOnChild,"before:show"))},_triggerShowBufferedChildren:function(){this._isShown&&(i.each(this._bufferedChildren,i.partial(this._triggerMethodOnChild,"show")),this._bufferedChildren=[])},_triggerMethodOnChild:function(t,e){r.triggerMethodOn(e,t)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(t){this.destroyEmptyView();var e=this.getChildView(t),i=this.collection.indexOf(t);this.addChild(t,e,i)},_onCollectionRemove:function(t){var e=this.children.findByModel(t);this.removeChildView(e),this.checkEmpty()},onShowCalled:function(){this.children.each(i.partial(this._triggerMethodOnChild,"show"))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.triggerMethod("render",this),this},resortView:function(){this.render()},_sortViews:function(){this.collection.find(function(t,e){var i=this.children.findByModel(t);return!i||i._index!==e},this)&&this.resortView()},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren(),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this))},showCollection:function(){var t;this.collection.each(function(e,i){t=this.getChildView(e),this.addChild(e,t,i)},this)},showEmptyView:function(){var t=this.getEmptyView();if(t&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var i=new e.Model;this.addEmptyView(i,t),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(t,e){var n=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");i.isFunction(n)&&(n=n.call(this));var s=this.buildChildView(t,e,n);this.proxyChildEvents(s),this._isShown&&r.triggerMethodOn(s,"before:show"),this.children.add(s),this.renderChildView(s,-1),this._isShown&&r.triggerMethodOn(s,"show")},getChildView:function(t){var e=this.getOption("childView");if(!e)throw new r.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return e},addChild:function(t,e,n){var r=this.getOption("childViewOptions");i.isFunction(r)&&(r=r.call(this,t,n));var s=this.buildChildView(t,e,r);return this._updateIndices(s,!0,n),this._addChildView(s,n),s},_updateIndices:function(t,e,i){this.sort&&(e?(t._index=i,this.children.each(function(e){e._index>=t._index&&e._index++})):this.children.each(function(e){e._index>=t._index&&e._index--}))},_addChildView:function(t,e){this.proxyChildEvents(t),this.triggerMethod("before:add:child",t),this.children.add(t),this.renderChildView(t,e),this._isShown&&!this.isBuffering&&r.triggerMethodOn(t,"show"),this.triggerMethod("add:child",t)},renderChildView:function(t,e){return t.render(),this.attachHtml(this,t,e),t},buildChildView:function(t,e,n){return new e(i.extend({model:t},n))},removeChildView:function(t){return t&&(this.triggerMethod("before:remove:child",t),t.destroy?t.destroy():t.remove&&t.remove(),this.stopListening(t),this.children.remove(t),this.triggerMethod("remove:child",t),this._updateIndices(t,!1)),t},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(t,e){t.$el.append(e)},attachHtml:function(t,e,i){t.isBuffering?(t.elBuffer.appendChild(e.el),t._bufferedChildren.push(e)):t._insertBefore(e,i)||t._insertAfter(e)},_insertBefore:function(t,e){var i;return this.sort&&e<this.children.length-1&&(i=this.children.find(function(t){return t._index===e+1})),!!i&&(i.$el.before(t.el),!0)},_insertAfter:function(t){this.$el.append(t.el)},_initChildViewStorage:function(){this.children=new e.ChildViewContainer},destroy:function(){if(!this.isDestroyed)return this.triggerMethod("before:destroy:collection"),this.destroyChildren(),this.triggerMethod("destroy:collection"),r.View.prototype.destroy.apply(this,arguments)},destroyChildren:function(){var t=this.children.map(i.identity);return this.children.each(this.removeChildView,this),this.checkEmpty(),t},proxyChildEvents:function(t){var e=this.getOption("childViewEventPrefix");this.listenTo(t,"all",function(){var n=s.call(arguments),r=n[0],o=this.normalizeMethods(i.result(this,"childEvents"));n[0]=e+":"+r,n.splice(1,0,t),void 0!==o&&i.isFunction(o[r])&&o[r].apply(this,n.slice(1)),this.triggerMethod.apply(this,n)},this)}}),r.CompositeView=r.CollectionView.extend({constructor:function(){r.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(t){var e=this.getOption("childView")||this.constructor;if(!e)throw new r.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return e},serializeData:function(){var t={};return this.model&&(t=i.partial(this.serializeModel,this.model).apply(this,arguments)),t},render:function(){return this._ensureViewIsIntact(),this.isRendered=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this.triggerMethod("render",this),this},_renderChildren:function(){this.isRendered&&r.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var t={};t=this.serializeData(),t=this.mixinTemplateHelpers(t),this.triggerMethod("before:render:template");var e=this.getTemplate(),i=r.Renderer.render(e,t,this);this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(t){return this.$el.html(t),this},attachBuffer:function(t,e){this.getChildViewContainer(t).append(e)},_insertAfter:function(t){this.getChildViewContainer(this).append(t.el)},getChildViewContainer:function(t){if("$childViewContainer"in t)return t.$childViewContainer;var e,n=r.getOption(t,"childViewContainer");if(n){var s=i.isFunction(n)?n.call(t):n;if((e="@"===s.charAt(0)&&t.ui?t.ui[s.substr(4)]:t.$(s)).length<=0)throw new r.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+t.childViewContainer})}else e=t.$el;return t.$childViewContainer=e,e},resetChildViewContainer:function(){this.$childViewContainer&&delete this.$childViewContainer}}),r.LayoutView=r.ItemView.extend({regionClass:r.Region,constructor:function(t){t=t||{},this._firstRender=!0,this._initializeRegions(t),r.ItemView.call(this,t)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),r.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.regionManager.destroy(),r.ItemView.prototype.destroy.apply(this,arguments))},addRegion:function(t,e){this.triggerMethod("before:region:add",t);var i={};return i[t]=e,this._buildRegions(i)[t]},addRegions:function(t){return this.regions=i.extend({},this.regions,t),this._buildRegions(t)},removeRegion:function(t){return this.triggerMethod("before:region:remove",t),delete this.regions[t],this.regionManager.removeRegion(t)},getRegion:function(t){return this.regionManager.get(t)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(t){var e=this,i={regionClass:this.getOption("regionClass"),parentEl:function(){return e.$el}};return this.regionManager.addRegions(t,i)},_initializeRegions:function(t){var e;this._initRegionManager(),e=i.isFunction(this.regions)?this.regions(t):this.regions||{};var n=this.getOption.call(t,"regions");i.isFunction(n)&&(n=n.call(this,t)),i.extend(e,n),e=this.normalizeUIValues(e),this.addRegions(e)},_reInitializeRegions:function(){this.regionManager.emptyRegions(),this.regionManager.each(function(t){t.reset()})},getRegionManager:function(){return new r.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.listenTo(this.regionManager,"before:add:region",function(t){this.triggerMethod("before:add:region",t)}),this.listenTo(this.regionManager,"add:region",function(t,e){this[t]=e,this.triggerMethod("add:region",t,e)}),this.listenTo(this.regionManager,"before:remove:region",function(t){this.triggerMethod("before:remove:region",t)}),this.listenTo(this.regionManager,"remove:region",function(t,e){delete this[t],this.triggerMethod("remove:region",t,e)})}}),r.Behavior=function(t,e){function i(e,i){this.view=i,this.defaults=t.result(this,"defaults")||{},this.options=t.extend({},this.defaults,e),this.$=function(){return this.view.$.apply(this.view,arguments)},this.initialize.apply(this,arguments)}return t.extend(i.prototype,e.Events,{initialize:function(){},destroy:function(){this.stopListening()},proxyViewProperties:function(t){this.$el=t.$el,this.el=t.el},triggerMethod:r.triggerMethod,getOption:r.proxyGetOption,bindEntityEvents:r.proxyBindEntityEvents,unbindEntityEvents:r.proxyUnbindEntityEvents}),i.extend=r.extend,i}(i,e),r.Behaviors=function(t,e){function i(t,n){return e.isObject(t.behaviors)?(n=i.parseBehaviors(t,n||e.result(t,"behaviors")),i.wrap(t,n,e.keys(r)),n):{}}function n(t,i){this._view=t,this._viewUI=e.result(t,"ui"),this._behaviors=i,this._triggers={}}var r={behaviorTriggers:function(t,e){return new n(this,e).buildBehaviorTriggers()},behaviorEvents:function(i,n){var r={},s=e.result(this,"ui");return e.each(n,function(i,n){var o={},a=e.clone(e.result(i,"events"))||{},l=e.result(i,"ui"),c=e.extend({},s,l);a=t.normalizeUIKeys(a,c),e.each(e.keys(a),function(t){var r=t+new Array(n+2).join(" "),s=e.isFunction(a[t])?a[t]:i[a[t]];o[r]=e.bind(s,i)}),r=e.extend(r,o)}),r}};return e.extend(i,{behaviorsLookup:function(){throw new t.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(t,n){return t.behaviorClass?t.behaviorClass:e.isFunction(i.behaviorsLookup)?i.behaviorsLookup.apply(this,arguments)[n]:i.behaviorsLookup[n]},parseBehaviors:function(t,n){return e.chain(n).map(function(n,r){var s=new(i.getBehaviorClass(n,r))(n,t),o=i.parseBehaviors(t,e.result(s,"behaviors"));return[s].concat(o)}).flatten().value()},wrap:function(t,i,n){e.each(n,function(n){t[n]=e.partial(r[n],t[n],i)})}}),e.extend(n.prototype,{buildBehaviorTriggers:function(){return e.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(i,n){var r=e.extend({},this._viewUI,e.result(i,"ui")),s=e.clone(e.result(i,"triggers"))||{};s=t.normalizeUIKeys(s,r),e.each(s,e.partial(this._setHandlerForBehavior,i,n),this)},_setHandlerForBehavior:function(t,e,i,n){var r=n.replace(/^\S+/,function(t){return t+".behaviortriggers"+e});this._triggers[r]=this._view._buildViewTrigger(i)}}),i}(r,i),r.AppRouter=e.Router.extend({constructor:function(t){e.Router.apply(this,arguments),this.options=t||{};var i=this.getOption("appRoutes"),n=this._getController();this.processAppRoutes(n,i),this.on("route",this._processOnRoute,this)},appRoute:function(t,e){var i=this._getController();this._addAppRoute(i,t,e)},_processOnRoute:function(t,e){var n=i.invert(this.getOption("appRoutes"))[t];i.isFunction(this.onRoute)&&this.onRoute(t,n,e)},processAppRoutes:function(t,e){if(e){var n=i.keys(e).reverse();i.each(n,function(i){this._addAppRoute(t,i,e[i])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(t,e,n){var s=t[n];if(!s)throw new r.Error('Method "'+n+'" was not found on the controller');this.route(e,n,i.bind(s,t))},getOption:r.proxyGetOption}),r.Application=function(t){this.options=t,this._initializeRegions(t),this._initCallbacks=new r.Callbacks,this.submodules={},i.extend(this,t),this._initChannel(),this.initialize.apply(this,arguments)},i.extend(r.Application.prototype,e.Events,{initialize:function(){},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(t){this._initCallbacks.add(t)},start:function(t){this.triggerMethod("before:start",t),this._initCallbacks.run(t,this),this.triggerMethod("start",t)},addRegions:function(t){return this._regionManager.addRegions(t)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(t){return this._regionManager.removeRegion(t)},getRegion:function(t){return this._regionManager.get(t)},getRegions:function(){return this._regionManager.getRegions()},module:function(t,e){var i=r.Module.getClass(e),n=s.call(arguments);return n.unshift(this),i.create.apply(i,n)},getRegionManager:function(){return new r.RegionManager},_initializeRegions:function(t){var e=i.isFunction(this.regions)?this.regions(t):this.regions||{};this._initRegionManager();var n=r.getOption(t,"regions");return i.isFunction(n)&&(n=n.call(this,t)),i.extend(e,n),this.addRegions(e),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this.listenTo(this._regionManager,"before:add:region",function(t){this.triggerMethod("before:add:region",t)}),this.listenTo(this._regionManager,"add:region",function(t,e){this[t]=e,this.triggerMethod("add:region",t,e)}),this.listenTo(this._regionManager,"before:remove:region",function(t){this.triggerMethod("before:remove:region",t)}),this.listenTo(this._regionManager,"remove:region",function(t,e){delete this[t],this.triggerMethod("remove:region",t,e)})},_initChannel:function(){this.channelName=i.result(this,"channelName")||"global",this.channel=i.result(this,"channel")||e.Wreqr.radio.channel(this.channelName),this.vent=i.result(this,"vent")||this.channel.vent,this.commands=i.result(this,"commands")||this.channel.commands,this.reqres=i.result(this,"reqres")||this.channel.reqres},triggerMethod:r.triggerMethod,getOption:r.proxyGetOption}),r.Application.extend=r.extend,r.Module=function(t,e,n){this.moduleName=t,this.options=i.extend({},this.options,n),this.initialize=n.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=e,i.isFunction(this.initialize)&&this.initialize(t,e,this.options)},r.Module.extend=r.extend,i.extend(r.Module.prototype,e.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(t){this._initializerCallbacks.add(t)},addFinalizer:function(t){this._finalizerCallbacks.add(t)},start:function(t){this._isInitialized||(i.each(this.submodules,function(e){e.startWithParent&&e.start(t)}),this.triggerMethod("before:start",t),this._initializerCallbacks.run(t,this),this._isInitialized=!0,this.triggerMethod("start",t))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),i.each(this.submodules,function(t){t.stop()}),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(t,e){this._runModuleDefinition(t,e)},_runModuleDefinition:function(t,n){if(t){var s=i.flatten([this,this.app,e,r,e.$,i,n]);t.apply(this,s)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new r.Callbacks,this._finalizerCallbacks=new r.Callbacks},triggerMethod:r.triggerMethod}),i.extend(r.Module,{create:function(t,e,n){var r=t,o=s.call(arguments);o.splice(0,3);var a=(e=e.split(".")).length,l=[];return l[a-1]=n,i.each(e,function(e,i){var s=r;r=this._getModule(s,e,t,n),this._addModuleDefinition(s,r,l[i],o)},this),r},_getModule:function(t,e,n,r,s){var o=i.extend({},r),a=this.getClass(r),l=t[e];return l||(l=new a(e,n,o),t[e]=l,t.submodules[e]=l),l},getClass:function(t){var e=r.Module;return t?t.prototype instanceof e?t:t.moduleClass||e:e},_addModuleDefinition:function(t,e,i,n){var r=this._getDefine(i),s=this._getStartWithParent(i,e);r&&e.addDefinition(r,n),this._addStartWithParent(t,e,s)},_getStartWithParent:function(t,e){var n;return i.isFunction(t)&&t.prototype instanceof r.Module?(n=e.constructor.prototype.startWithParent,!!i.isUndefined(n)||n):!i.isObject(t)||(n=t.startWithParent,!!i.isUndefined(n)||n)},_getDefine:function(t){return!i.isFunction(t)||t.prototype instanceof r.Module?i.isObject(t)?t.define:null:t},_addStartWithParent:function(t,e,i){e.startWithParent=e.startWithParent&&i,e.startWithParent&&!e.startWithParentIsConfigured&&(e.startWithParentIsConfigured=!0,t.addInitializer(function(t){e.startWithParent&&e.start(t)}))}}),r}),define("apps/home/controller",["marionette"],function(t){"use strict";return t.Controller.extend({initialize:function(t){this.app=t.app},mediaDetail:function(t,e){this.app.vent.trigger("show-detail",{id:e,dataType:t},!1)},mediaList:function(t){this.app.vent.trigger("show-list",t)}})}),define("apps/home/router",["jquery","marionette","backbone","apps/home/controller"],function(t,e,i,n){"use strict";return e.AppRouter.extend({appRoutes:{":dataType/:id":"mediaDetail",":dataType":"mediaList"},initialize:function(t){this.controller=new n({app:t.app}),e.AppRouter.prototype.initialize.apply(this,[t]),this.applyRoutingHacks()},applyRoutingHacks:function(){t("a").click(function(){"#/"+i.history.fragment==t(this).attr("href")&&i.history.loadUrl(i.history.fragment)})}})}),define("text",["module"],function(t){"use strict";var e,i,n,r,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,h=c&&location.protocol&&location.protocol.replace(/\:/,""),u=c&&location.hostname,d=c&&(location.port||void 0),f={},p=t.config&&t.config()||{};return e={version:"2.0.12",strip:function(t){if(t){var e=(t=t.replace(a,"")).match(l);e&&(t=e[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var t,e,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(e=0;e<3;e+=1){i=o[e];try{t=new ActiveXObject(i)}catch(t){}if(t){o=[i];break}}return t},parseName:function(t){var e,i,n,r=!1,s=t.indexOf("."),o=0===t.indexOf("./")||0===t.indexOf("../");return-1!==s&&(!o||s>1)?(e=t.substring(0,s),i=t.substring(s+1,t.length)):e=t,n=i||e,-1!==(s=n.indexOf("!"))&&(r="strip"===n.substring(s+1),n=n.substring(0,s),i?i=n:e=n),{moduleName:e,ext:i,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,i,n,r){var s,o,a,l=e.xdRegExp.exec(t);return!l||(s=l[2],o=l[3],o=o.split(":"),a=o[1],o=o[0],!(s&&s!==i||o&&o.toLowerCase()!==n.toLowerCase()||(a||o)&&a!==r))},finishLoad:function(t,i,n,r){n=i?e.strip(n):n,p.isBuild&&(f[t]=n),r(n)},load:function(t,i,n,r){if(r&&r.isBuild&&!r.inlineText)n();else{p.isBuild=r&&r.isBuild;var s=e.parseName(t),o=s.moduleName+(s.ext?"."+s.ext:""),a=i.toUrl(o),l=p.useXhr||e.useXhr;0!==a.indexOf("empty:")?!c||l(a,h,u,d)?e.get(a,function(i){e.finishLoad(t,s.strip,i,n)},function(t){n.error&&n.error(t)}):i([o],function(t){e.finishLoad(s.moduleName+"."+s.ext,s.strip,t,n)}):n()}},write:function(t,i,n,r){if(f.hasOwnProperty(i)){var s=e.jsEscape(f[i]);n.asModule(t+"!"+i,"define(function () { return '"+s+"';});\n")}},writeFile:function(t,i,n,r,s){var o=e.parseName(i),a=o.ext?"."+o.ext:"",l=o.moduleName+a,c=n.toUrl(o.moduleName+a)+".js";e.load(l,n,function(i){var n=function(t){return r(c,t)};n.asModule=function(t,e){return r.asModule(t,c,e)},e.write(t,l,n,s)},s)}},"node"===p.env||!p.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(i=require.nodeRequire("fs"),e.get=function(t,e,n){try{var r=i.readFileSync(t,"utf8");0===r.indexOf("\ufeff")&&(r=r.substring(1)),e(r)}catch(t){n&&n(t)}}):"xhr"===p.env||!p.env&&e.createXhr()?e.get=function(t,i,n,r){var s,o=e.createXhr();if(o.open("GET",t,!0),r)for(s in r)r.hasOwnProperty(s)&&o.setRequestHeader(s.toLowerCase(),r[s]);p.onXhr&&p.onXhr(o,t),o.onreadystatechange=function(e){var r,s;4===o.readyState&&((r=o.status||0)>399&&r<600?((s=new Error(t+" HTTP status: "+r)).xhr=o,n&&n(s)):i(o.responseText),p.onXhrComplete&&p.onXhrComplete(o,t))},o.send(null)}:"rhino"===p.env||!p.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?e.get=function(t,e){var i,n,r=new java.io.File(t),s=java.lang.System.getProperty("line.separator"),o=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),"utf-8")),a="";try{for(i=new java.lang.StringBuffer,(n=o.readLine())&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=o.readLine());)i.append(s),i.append(n);a=String(i.toString())}finally{o.close()}e(a)}:("xpconnect"===p.env||!p.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,r=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in n,e.get=function(t,e){var i,o,a,l={};s&&(t=t.replace(/\//g,"\\")),a=new FileUtils.File(t);try{(i=n["@mozilla.org/network/file-input-stream;1"].createInstance(r.nsIFileInputStream)).init(a,1,0,!1),(o=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(r.nsIConverterInputStream)).init(i,"utf-8",i.available(),r.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(i.available(),l),o.close(),i.close(),e(l.value)}catch(t){throw new Error((a&&a.path||"")+": "+t)}}),e}),define("text!apps/home/templates/project-item.html",[],function(){return'<div class="project-overview" >\n    <a href="/data/?project_id={{ id }}#/map">\n\n        <h2 class="map-title" >{{ name }}</h2>\n        <span class = "owner">Owner: {{ owner }}</span>\n        <p>{{ caption }}</p>\n        <a class="action">\n            <i class="fa fa-edit"></i> Edit\n        </a>\n    </a>\n    <div class="project-detail">\n        <a class="tag action">\n            {{#ifequal access_authority 1}}\n                <i class="fa fa-lock"></i>\n                Private\n            {{ else }}\n                <i class="fa fa-globe"></i>\n                Public\n            {{/ifequal}}\n        </a>\n        <span class="time-stamp"><i class="fa fa-clock-o" aria-hidden="true"></i> {{timeAgo}}</span>\n    </div>\n</div>\n'}),define("apps/home/views/projectItemView",["marionette","underscore","jquery","handlebars","text!../templates/project-item.html"],function(t,e,i,n,r){"use strict";return t.ItemView.extend({timeStamp:null,dateCreated:null,currentDate:null,lastEditedString:null,initialize:function(i){e.extend(this,i),t.ItemView.prototype.initialize.call(this),this.currentDate=new Date,this.timeStamp=new Date(this.model.get("time_stamp")+"Z"),this.dateCreated=new Date(this.model.get("date_created")+"Z"),this.lastEditedString=this.lastEdited()},template:n.compile(r),events:{"click .action":"shareModal"},className:"project-card",modelEvents:{change:"render"},shareModal:function(t){this.app.vent.trigger("share-project",{model:this.model}),t&&t.preventDefault()},templateHelpers:function(){return{projectUsers:this.model.projectUsers.toJSON(),timeAgo:this.lastEditedString}},deleteProjectView:function(){confirm("Are you sure you want to delete this project?")&&this.model.destroy()},lastEdited:function(){var t=this.timeStamp.getFullYear(),e=this.timeStamp.getMonth(),i=this.timeStamp.getDate(),n=this.currentDate.getFullYear()-t,r=this.currentDate.getMonth()-e,s=this.currentDate.getDate()-i;return r<0&&(r+=12,n--),s<0&&(s+=this.daysPerMonth(this.currentDate),r--),n>0&&!(r<0)?n+" Year"+(n>1?"s":"")+" ago":r>0&&!(s<0)?r+" Month"+(r>1?"s":"")+" ago":s>0?s+" Day"+(s>1?"s":"")+" ago":"Today"},daysPerYear:function(t){return t.getFullYear(),365},daysPerMonth:function(t){var e=t.getMonth();return 1==e?366==this.daysPerYear(t)?29:28:3==e||5==e||8==e||10==e?30:31},setTimeStamp:function(t){this.timeStamp=t}})}),define("lib/maps/geometry/point",[],function(){"use strict";return function(){this.getGeoJSON=function(t){return{type:"Point",coordinates:[t.lng(),t.lat()]}},this.getGoogleLatLng=function(t){return new google.maps.LatLng(t.coordinates[1],t.coordinates[0])},this.printLatLng=function(t,e){return e=e||2,t.coordinates[1].toFixed(e)+", "+t.coordinates[0].toFixed(e)}}}),define("lib/maps/geometry/polyline",[],function(){"use strict";return function(){this.getGeoJSON=function(t){var e=t.getArray(),i=[],n=0;for(n;n<e.length;n++)i.push([e[n].lng(),e[n].lat()]);return{type:"LineString",coordinates:i}},this.getGooglePath=function(t){var e=[],i=t.coordinates,n=0;for(n;n<i.length;n++)e.push(new google.maps.LatLng(i[n][1],i[n][0]));return e},this.calculateDistance=function(t){var e=t.getPath().getArray(),i=0,n=0;for(n;n<e.length;n++)i+=google.maps.geometry.spherical.computeDistanceBetween(e[n-1],e[n]);return Math.round(i/1609.34*100)/100},this.getBounds=function(t){var e=new google.maps.LatLngBounds,i=t.getPath().getArray(),n=0;for(n;n<i.length;n++)e.extend(i[n]);return e},this.getCenterPoint=function(t){var e=t.getPath().getArray();return e[Math.floor(e.length/2)]},this.getCenterPointFromGeoJSON=function(t){var e=this.getGooglePath(t);return e[Math.floor(e.length/2)]}}}),define("lib/maps/geometry/polygon",["lib/maps/geometry/polyline"],function(t){"use strict";return function(){t.call(this),this.getGeoJSON=function(t){var e=t.getArray(),i=[],n=0;for(n;n<e.length;n++)i.push([e[n].lng(),e[n].lat()]);return i.push([e[0].lng(),e[0].lat()]),{type:"Polygon",coordinates:[i]}},this.getGooglePath=function(t){var e=[],i=t.coordinates[0],n=0;for(n;n<i.length;n++)e.push(new google.maps.LatLng(i[n][1],i[n][0]));return e.pop(),e},this.getCenterPoint=function(t){return this.getBounds(t).getCenter()},this.getCenterPointFromGeoJSON=function(t){var e=this.getGooglePath(t),i=new google.maps.LatLngBounds,n=0;for(n;n<e.length;n++)i.extend(e[n]);return i.getCenter()}}}),define("lib/maps/geometry/geometry",["lib/maps/geometry/point","lib/maps/geometry/polyline","lib/maps/geometry/polygon"],function(t,e,i){"use strict";return function(){this.point=null,this.polyline=null,this.polygon=null,this.getGeoJSON=function(t){return t instanceof google.maps.LatLng?this.point.getGeoJSON(t):t instanceof google.maps.Marker?this.point.getGeoJSON(t.position):t instanceof google.maps.Polyline?this.polyline.getGeoJSON(t.getPath()):t instanceof google.maps.Polygon?this.polygon.getGeoJSON(t.getPath()):(alert("Not an instance of a defined type!"),null)},this.initialize=function(){this.point=new t,this.polyline=new e,this.polygon=new i},this.initialize()}}),define("models/base",["underscore","jquery","backbone","form","lib/maps/geometry/geometry","lib/maps/geometry/point"],function(t,e,i,n,r,s){"use strict";n.JSONFormatter=function(){};return i.Model.extend({schema:{name:"Text",caption:{type:"TextArea"},tags:"Text"},getDataTypePlural:function(){if(this.collection&&this.collection.getDataType())return this.collection.getDataType();var t=this.get("overlay_type");return"audio"==t?"audio":t+"s"},getDataType:function(){return this.get("overlay_type")},filterFields:["name","tags","owner","caption","attribution"],defaults:{name:"Untitled",isVisible:!0},urlRoot:null,updateSchema:null,hiddenFields:["geometry","overlay_type","project_id","url","num","manually_reviewed"],validatorFunction:function(t,e){var i={type:"json",message:"Value must be a JSON object"};try{return JSON.parse(t),null}catch(e){return t?i:null}},dataTypes:{string:"Text",float:"Number",integer:"Number",boolean:"Checkbox",geojson:"TextArea",memo:"TextArea",json:"TextArea"},parse:function(t,e){return e&&!e.parse?null:t},initialize:function(e,i){i=i||{},this.generateUpdateSchema(i.updateMetadata);var n=this.get("geometry");!t.isUndefined(n)&&t.isString(n)&&this.set("geometry",JSON.parse(n))},setPointFromLatLng:function(t,e){t=t||this.get("lat"),e=e||this.get("lng");var i=this.get("geometry");return i&&"Point"===i.type?(t&&(i.coordinates[1]=t),e&&(i.coordinates[0]=e)):i=!i&&t&&e?{type:"Point",coordinates:[e,t]}:null,this.set("geometry",i),i},set:function(t,e){if(t.hasOwnProperty("geometry")||"geometry"===t){var n=t.geometry;n&&"Point"===n.type&&(t.lat=n.coordinates[1],t.lng=n.coordinates[0])}return i.Model.prototype.set.call(this,t,e)},toJSON:function(){var t=i.Model.prototype.toJSON.call(this);return null!=t.geometry&&(t.geometry=JSON.stringify(t.geometry)),null!=t.extras&&(t.extras=JSON.stringify(t.extras)),t},toTemplateJSON:function(){var t=i.Model.prototype.toJSON.call(this);return t.key=this.getKey(),t},getKey:function(){if(this.collection.key)return this.collection.key;switch(this.get("overlay_type")){case"photo":return"photos";case"audio":return"audio";case"marker":return"markers";default:alert("case not handled")}},getCenter:function(){var t=this.get("geometry"),e=new s;return t?e.getGoogleLatLng(t):null},printLatLng:function(t){return(new s).printLatLng(this.get("geometry"),t)},setExtras:function(t){try{t=JSON.parse(t),this.set({extras:t},{silent:!0})}catch(t){this.set({extras:null},{silent:!0})}},fetchCreateMetadata:function(){var t=this;this.urlRoot||(this.urlRoot=this.collection.url),e.ajax({url:this.urlRoot+".json",type:"OPTIONS",data:{_method:"OPTIONS"},success:function(e){t.createMetadata=e.actions.POST}})},fetchUpdateMetadata:function(t){var i=this;null==this.urlRoot&&(this.urlRoot=this.collection.url),e.ajax({url:this.urlRoot+this.id+"/.json",type:"OPTIONS",data:{_method:"OPTIONS"},success:function(e){i.updateMetadata=e.actions.PUT,t()}})},generateUpdateSchema:function(t){this.updateSchema=this._generateSchema(t,!0)},generateCreateSchema:function(t){this.createSchema=this._generateSchema(t,!0)},_generateSchema:function(e,i){if(!e)return null;var n,r,s={};for(n in e)r=e[n],-1===this.hiddenFields.indexOf(n)&&(i&&r.read_only||(s[n]={type:this.dataTypes[r.type]||"Text",title:r.label||n,help:r.help_text},r.choices&&(s[n].type="Select",s[n].options=[],t.each(r.choices,function(t){s[n].options.push({val:t.value,label:t.display_name})})),s[n].title,-1!=r.type.indexOf("json")&&(s[n].validators=[this.validatorFunction])));return s},setGeometryFromOverlay:function(t){var e=(new r).getGeoJSON(t);this.set({geometry:e}),"Point"===e.type&&this.set({lat:e.coordinates[1],lng:e.coordinates[0]})},getFormSchema:function(){return{name:{type:"TextArea",title:"Name"},caption:{type:"TextArea",title:"Caption"},attribution:{type:"TextArea",title:"Attribution"},tags:{type:"List",itemType:"Text"}}}})}),define("models/projectUser",["underscore","models/base"],function(t,e){"use strict";return e.extend({defaults:t.extend({},e.prototype.defaults,{isActive:!1,isVisible:!1,checked:!1}),initialize:function(t,i){if(this.collection&&this.collection.url)this.urlRoot=this.collection.url;else{if(!i.id)return void alert("id initialization parameter required for ProjectUser");this.urlRoot="/api/0/projects/"+i.id+"/users/"}this.get("user")&&(this.url=this.urlRoot+this.get("user")+"/"),e.prototype.initialize.apply(this,arguments)},destroy:function(e){var i=t.extend({url:this.urlRoot+this.get("user")+"/"},e||{});return Backbone.Model.prototype.destroy.call(this,i)}})}),define("backbone-pageable",["underscore","backbone"],function(t,e){"use strict";function i(e,i){if(!t.isNumber(e)||t.isNaN(e)||!t.isFinite(e)||~~e!==e)throw new TypeError("`"+i+"` must be a finite integer");return e}function n(t){for(var e,i,n,r,s={},o=decodeURIComponent,a=t.split("&"),l=0,c=a.length;l<c;l++)i=(e=a[l].split("="))[0],n=e[1]||!0,i=o(i),n=o(n),r=s[i],p(r)?r.push(n):s[i]=r?[r,n]:n;return s}function r(t,e,i){var n=t._events[e];if(n&&n.length){var r=n[n.length-1],s=r.callback;r.callback=function(){try{s.apply(this,arguments),i()}catch(t){throw t}finally{r.callback=s}}}else i()}var s=t.extend,o=t.omit,a=t.clone,l=t.each,c=t.pick,h=t.contains,u=t.isEmpty,d=t.pairs,f=t.invert,p=t.isArray,g=t.isFunction,m=t.isObject,v=t.keys,y=t.isUndefined,w=t.result,b=Math.ceil,_=Math.floor,x=Math.max,C=e.Collection.prototype,E=/[\s'"]/g,S=/[<>\s'"]/g,M=e.PageableCollection=e.Collection.extend({state:{firstPage:1,lastPage:null,currentPage:null,pageSize:25,totalPages:null,totalRecords:null,sortKey:null,order:-1},mode:"server",queryParams:{currentPage:"page",pageSize:"per_page",totalPages:"total_pages",totalRecords:"total_entries",sortKey:"sort_by",order:"order",directions:{"-1":"asc",1:"desc"}},constructor:function(t,e){C.constructor.apply(this,arguments),e=e||{};var i=this.mode=e.mode||this.mode||T.mode,n=s({},T.queryParams,this.queryParams,e.queryParams||{});n.directions=s({},T.queryParams.directions,this.queryParams.directions,n.directions||{}),this.queryParams=n;var r=this.state=s({},T.state,this.state,e.state||{});r.currentPage=null==r.currentPage?r.firstPage:r.currentPage,p(t)||(t=t?[t]:[]),t=t.slice(),"server"==i||null!=r.totalRecords||u(t)||(r.totalRecords=t.length),this.switchMode(i,s({fetch:!1,resetState:!1,models:t},e));var o=e.comparator;if(r.sortKey&&!o&&this.setSorting(r.sortKey,r.order,e),"server"!=i){var l=this.fullCollection;o&&e.full&&(this.comparator=null,l.comparator=o),e.full&&l.sort(),t&&!u(t)&&(this.reset(t,s({silent:!0},e)),this.getPage(r.currentPage),t.splice.apply(t,[0,t.length].concat(this.models)))}this._initState=a(this.state)},_makeFullCollection:function(t,i){var n,r,s,o=["url","model","sync","comparator"],a=this.constructor.prototype,l={};for(n=0,r=o.length;n<r;n++)y(a[s=o[n]])||(l[s]=a[s]);var c=new(e.Collection.extend(l))(t,i);for(n=0,r=o.length;n<r;n++)this[s=o[n]]!==a[s]&&(c[s]=this[s]);return c},_makeCollectionEventHandler:function(t,e){return function(i,n,o,c){var h=t._handlers;l(v(h),function(i){var n=h[i];t.off(i,n),e.off(i,n)});var u=a(t.state),d=u.firstPage,f=0===d?u.currentPage:u.currentPage-1,p=u.pageSize,g=f*p,m=g+p;if("add"==i){var w,_,x,c=c||{};if(o==e)(_=e.indexOf(n))>=g&&_<m&&(x=t,w=C=_-g);else{_=g+(w=t.indexOf(n)),x=e;var C=y(c.at)?_:c.at+g}if(c.onRemove||(++u.totalRecords,delete c.onRemove),t.state=t._checkState(u),x){x.add(n,s({},c||{},{at:C}));var E=w>=p?n:!y(c.at)&&C<m&&t.length>p?t.at(p):null;E&&r(o,i,function(){t.remove(E,{onAdd:!0})})}}if("remove"==i)if(c.onAdd)delete c.onAdd;else{if(--u.totalRecords){var S=u.totalPages=b(u.totalRecords/p);u.lastPage=0===d?S-1:S||d,u.currentPage>S&&(u.currentPage=u.lastPage)}else u.totalRecords=null,u.totalPages=null;t.state=t._checkState(u);var M,T=c.index;o==t?((M=e.at(m))&&r(t,i,function(){t.push(M,{onRemove:!0})}),e.remove(n)):T>=g&&T<m&&((M=e.at(m-1))&&r(t,i,function(){t.push(M,{onRemove:!0})}),t.remove(n))}if("reset"==i)if(c=o,(o=n)==t&&null==c.from&&null==c.to){var j=e.models.slice(0,g),P=e.models.slice(g+t.models.length);e.reset(j.concat(t.models).concat(P),c)}else o==e&&((u.totalRecords=e.models.length)||(u.totalRecords=null,u.totalPages=null),"client"==t.mode&&(u.lastPage=u.currentPage=u.firstPage),t.state=t._checkState(u),t.reset(e.models.slice(g,m),s({},c,{parse:!1})));"sort"==i&&(c=o,(o=n)===e&&t.reset(e.models.slice(g,m),s({},c,{parse:!1}))),l(v(h),function(i){var n=h[i];l([t,e],function(t){t.on(i,n);var e=t._events[i]||[];e.unshift(e.pop())})})}},_checkState:function(t){var e=this.mode,n=this.links,r=t.totalRecords,s=t.pageSize,o=t.currentPage,a=t.firstPage,l=t.totalPages;if(null!=r&&null!=s&&null!=o&&null!=a&&("infinite"!=e||n)){if(r=i(r,"totalRecords"),s=i(s,"pageSize"),o=i(o,"currentPage"),a=i(a,"firstPage"),s<1)throw new RangeError("`pageSize` must be >= 1");if(l=t.totalPages=b(r/s),a<0||a>1)throw new RangeError("`firstPage must be 0 or 1`");if(t.lastPage=0===a?x(0,l-1):l||a,"infinite"==e){if(!n[o+""])throw new RangeError("No link found for page "+o)}else if(o<a||l>0&&(a?o>l:o>=l))throw new RangeError("`currentPage` must be firstPage <= currentPage "+(a?">":">=")+" totalPages if "+a+"-based. Got "+o+".")}return t},setPageSize:function(t,e){t=i(t,"pageSize"),e=e||{first:!1};var n=this.state,r=b(n.totalRecords/t),a=r?x(n.firstPage,_(r*n.currentPage/n.totalPages)):n.firstPage;return n=this.state=this._checkState(s({},n,{pageSize:t,currentPage:e.first?n.firstPage:a,totalPages:r})),this.getPage(n.currentPage,o(e,["first"]))},switchMode:function(e,i){if(!h(["server","client","infinite"],e))throw new TypeError('`mode` must be one of "server", "client" or "infinite"');i=i||{fetch:!0,resetState:!0};var n=this.state=i.resetState?a(this._initState):this._checkState(s({},this.state));this.mode=e;var r,c=this,u=this.fullCollection,d=this._handlers=this._handlers||{};if("server"==e||u)"server"==e&&u&&(l(v(d),function(t){r=d[t],c.off(t,r),u.off(t,r)}),delete this._handlers,this._fullComparator=u.comparator,delete this.fullCollection);else{(u=this._makeFullCollection(i.models||[],i)).pageableCollection=this,this.fullCollection=u;var f=this._makeCollectionEventHandler(this,u);l(["add","remove","reset","sort"],function(e){d[e]=r=t.bind(f,{},e),c.on(e,r),u.on(e,r)}),u.comparator=this._fullComparator}if("infinite"==e)for(var p=this.links={},g=n.firstPage,m=b(n.totalRecords/n.pageSize),y=0===g?x(0,m-1):m||g,w=n.firstPage;w<=y;w++)p[w]=this.url;else this.links&&delete this.links;return i.fetch?this.fetch(o(i,"fetch","resetState")):this},hasPreviousPage:function(){var t=this.state,e=t.currentPage;return"infinite"!=this.mode?e>t.firstPage:!!this.links[e-1]},hasPrevious:function(){return"undefined"!=typeof console&&console.warn&&console.warn("hasPrevious has been deprecated, use hasPreviousPage instead"),this.hasPreviousPage()},hasNextPage:function(){var t=this.state,e=this.state.currentPage;return"infinite"!=this.mode?e<t.lastPage:!!this.links[e+1]},hasNext:function(){return"undefined"!=typeof console&&console.warn&&console.warn("hasNext has been deprecated, use hasNextPage instead"),this.hasNextPage()},getFirstPage:function(t){return this.getPage("first",t)},getPreviousPage:function(t){return this.getPage("prev",t)},getNextPage:function(t){return this.getPage("next",t)},getLastPage:function(t){return this.getPage("last",t)},getPage:function(t,e){var n=this.mode,r=this.fullCollection;e=e||{fetch:!1};var a=this.state,l=a.firstPage,c=a.currentPage,h=a.lastPage,d=a.pageSize,f=t;switch(t){case"first":f=l;break;case"prev":f=c-1;break;case"next":f=c+1;break;case"last":f=h;break;default:f=i(t,"index")}this.state=this._checkState(s({},a,{currentPage:f})),e.from=c,e.to=f;var p=(0===l?f:f-1)*d,g=r&&r.length?r.models.slice(p,p+d):[];return"client"!=n&&("infinite"!=n||u(g))||e.fetch?("infinite"==n&&(e.url=this.links[f]),this.fetch(o(e,"fetch"))):(this.reset(g,o(e,"fetch")),this)},getPageByOffset:function(t,e){if(t<0)throw new RangeError("`offset must be > 0`");t=i(t);var n=_(t/this.state.pageSize);return 0!==this.state.firstPage&&n++,n>this.state.lastPage&&(n=this.state.lastPage),this.getPage(n,e)},sync:function(t,i,n){var r=this;if("infinite"==r.mode){var o=n.success,a=r.state.currentPage;n.success=function(t,e,i){var l=r.links,c=r.parseLinks(t,s({xhr:i},n));c.first&&(l[r.state.firstPage]=c.first),c.prev&&(l[a-1]=c.prev),c.next&&(l[a+1]=c.next),o&&o(t,e,i)}}return(C.sync||e.sync).call(r,t,i,n)},parseLinks:function(t,e){var i={},n=e.xhr.getResponseHeader("Link");if(n){var r=["first","prev","next"];l(n.split(","),function(t){var e=t.split(";"),n=e[0].replace(S,""),s=e.slice(1);l(s,function(t){var e=t.split("="),s=e[0].replace(E,""),o=e[1].replace(E,"");"rel"==s&&h(r,o)&&(i[o]=n)})})}return i},parse:function(t,e){var i=this.parseState(t,a(this.queryParams),a(this.state),e);return i&&(this.state=this._checkState(s({},this.state,i))),this.parseRecords(t,e)},parseState:function(e,i,n,r){if(e&&2===e.length&&m(e[0])&&p(e[1])){var s=a(n),c=e[0];return l(d(o(i,"directions")),function(e){var i=e[0],n=e[1],r=c[n];y(r)||t.isNull(r)||(s[i]=c[n])}),c.order&&(s.order=1*f(i.directions)[c.order]),s}},parseRecords:function(t,e){return t&&2===t.length&&m(t[0])&&p(t[1])?t[1]:t},fetch:function(t){t=t||{};var e=this._checkState(this.state),i=this.mode;"infinite"!=i||t.url||(t.url=this.links[e.currentPage]);var r=t.data||{},l=w(t,"url")||w(this,"url")||"",h=l.indexOf("?");-1!=h&&(s(r,n(l.slice(h+1))),l=l.slice(0,h)),t.url=l,t.data=r;var u,f,p,m,b="client"==this.mode?c(this.queryParams,"sortKey","order"):o(c(this.queryParams,v(T.queryParams)),"directions"),_=d(b),x=a(this);for(u=0;u<_.length;u++)p=(f=_[u])[0],m=f[1],m=g(m)?m.call(x):m,null!=e[p]&&null!=m&&(r[m]=e[p]);e.sortKey&&e.order?r[b.order]=this.queryParams.directions[e.order+""]:e.sortKey||delete r[b.order];var E=d(o(this.queryParams,v(T.queryParams)));for(u=0;u<E.length;u++)m=(f=E[u])[1],null!=(m=g(m)?m.call(x):m)&&(r[f[0]]=m);if("server"!=i){var S=this,M=this.fullCollection,j=t.success;return t.success=function(e,n,r){r=r||{},y(t.silent)?delete r.silent:r.silent=t.silent;var o=e.models;"client"==i?M.reset(o,r):(M.add(o,s({at:M.length},s(r,{parse:!1}))),S.trigger("reset",S,r)),j&&j(e,n,r)},C.fetch.call(this,s({},t,{silent:!0}))}return C.fetch.call(this,t)},_makeComparator:function(t,e,i){var n=this.state;if(t=t||n.sortKey,e=e||n.order,t&&e)return i||(i=function(t,e){return t.get(e)}),function(n,r){var s,o=i(n,t),a=i(r,t);return 1===e&&(s=o,o=a,a=s),o===a?0:o<a?-1:1}},setSorting:function(t,e,i){var n=this.state;n.sortKey=t,n.order=e=e||n.order;var r=this.fullCollection,o=!1,a=!1;t||(o=a=!0);var l=this.mode;i=s({side:"client"==l?l:"server",full:!0},i);var c=this._makeComparator(t,e,i.sortValue),h=i.full,u=i.side;return"client"==u?h?(r&&(r.comparator=c),o=!0):(this.comparator=c,a=!0):"server"!=u||h||(this.comparator=c),o&&(this.comparator=null),a&&r&&(r.comparator=null),this}}),T=M.prototype;return M}),define("lib/truthStatement",["jquery"],function(t){"use strict";return function(e,i){this.tokens=null,this.key=null,this.val=null,this.operator=null,this.conjunction=null,this.validOperators=[">=","<=","<>",">","<","!=","="," in "," like "," contains "," startswith "," endswith "],this.validConjunctions=["and","or"],this.parseStatement=function(t,e){"*"!==t?(this.setTokens(t),this.key=this.tokens[0].trim(),this.setOperator(this.tokens[1].trim()),this.val=this.tokens[2].trim(),this.setConjunction(e),this.compileSQLToJavascript()):this.operator="*"},this.setTokens=function(t){var e=new RegExp("([\\S\\s]*?)("+this.validOperators.join("|")+")([\\S\\s]*)"),i=t.match(e);if(i.shift(),3!=i.length)throw new Error("Statement should parse to three tokens");this.tokens=i},this.setOperator=function(t){if(t=t.toLowerCase().trim(),-1==this.validOperators.indexOf(t)&&-1==this.validOperators.indexOf(" "+t+" "))throw new Error("Operator must be one of the following: "+this.validOperators.join(", "));this.operator=t},this.setConjunction=function(t){if(t=t.toLowerCase().trim(),-1==this.validConjunctions.indexOf(t))throw new Error("Conjunction must be 'AND' or 'OR' (case insensitive)");this.conjunction=t},this._trimCharacter=function(t,e){return t[0]==e&&(t=t.substring(1)),t[t.length-1]==e&&(t=t.substring(0,t.length-1)),t},this.trimSingleQuotes=function(t){return this._trimCharacter(t,"'")},this.trimPercentages=function(t){return this._trimCharacter(t,"%")},this.trimParentheses=function(t){return t=this._trimCharacter(t,")"),this._trimCharacter(t,"(")},this.compileSQLToJavascript=function(){var t=0,e=!1,i=!1;if("in"==this.operator)for(this.val=this.trimParentheses(this.val),this.val=this.val.split(","),t=0;t<this.val.length;t++)this.val[t]=this.trimSingleQuotes(this.val[t].trim());else"like"==this.operator?(this.val=this.trimSingleQuotes(this.val),i="%"==this.val[this.val.length-1],e="%"==this.val[0],this.val=this.trimPercentages(this.val),this.operator=e&&i?"contains":i?"startswith":"endswith"):this.val=this.trimSingleQuotes(this.val)},this.truthTest=function(t){if("*"==this.operator)return!0;var e=!1,i=t.get(this.key),n=-1;return void 0!==i&&null!=i&&(i=this.convertType(i),"="==this.operator?e=i==this.val:">"==this.operator?e=i>this.val:">="==this.operator?e=i>=this.val:"<"==this.operator?e=i<this.val:"<="==this.operator?e=i<=this.val:-1!=["<>","!="].indexOf(this.operator)?e=i!=this.val:"in"==this.operator?e=-1!=this.val.indexOf(i):"contains"==this.operator?e=-1!=i.indexOf(this.val):"startswith"==this.operator?e=0==i.indexOf(this.val):"endswith"==this.operator&&(n=i.length-this.val.length,e=-1!==i.indexOf(this.val,n)),e)},this.convertType=function(e){var i=0,n="string"==typeof e,r="number"==typeof e?this.parseNum:this.parseString;if(t.isArray(this.val))for(i=0;i<this.val.length;i++)this.val[i]=r(this.val[i]);else this.val=r(this.val);return n&&(e=this.parseString(e)),e},this.parseNum=function(t){return parseInt(t,10)},this.parseString=function(t){return t.toString().toLowerCase()},this.debug=function(){console.log("key: ",this.key),console.log("operator: ",this.operator),console.log("value: ",this.val),console.log("conjunction: ",this.conjunction),console.log("tokens: ",this.tokens)},null!=e&&null!=i&&this.parseStatement(e,i)}}),define("lib/sqlParser",["lib/truthStatement"],function(t){"use strict";return function(e){var i=0;this.statements=[],this.sql=null,this.failureFlag=0,this.failureMessage="",this.init=function(e){this.sql=e.toLowerCase().replace("where","");var n=this.sql.split(/(\s+and\s+|\s+or\s+)/),r=null;for(n.unshift("and"),i=0;i<n.length;i+=2){n[i]=n[i].trim();try{r=new t(n[i+1],n[i]),this.statements.push(r)}catch(t){this.failureFlag=1,this.failureMessage="error parsing truth statement: "+t}}},this.checkModel=function(t){var e,i=0,n=!this.failureFlag;for(i=0;i<this.statements.length;i++)n="and"==(e=this.statements[i]).conjunction?n&&e.truthTest(t):n||e.truthTest(t);return n},this.init(e)}}),define("collections/baseMixin",["jquery","lib/sqlParser","underscore","backbone"],function(t,e,i,n){"use strict";return{dataTypes:{string:"Text",float:"Number",integer:"Number",boolean:"Checkbox",geojson:"TextArea",memo:"TextArea",json:"TextArea"},applyFilter:function(t){var i=new e(t),n=0,r=!1;this.each(function(t){i.checkModel(t)?t.set("isVisible",!0):(t.set("isVisible",!1),++n)}),n==this.models.length&&(r=!0),this.trigger("filtered",{doNotRender:r})},clearFilter:function(){this.each(function(t){t.set("isVisible",!0)}),this.trigger("filtered",{doNotRender:!1})},getVisibleModels:function(){var t=[];return this.each(function(e){e.get("isVisible")&&t.push(e)}),t},setServerQuery:function(t){this.query=t},clearServerQuery:function(){this.query=null},fetch:function(t){return this.query&&((t=t||{}).data=t.data||{},t.data={query:this.query}),n.Collection.prototype.fetch.call(this,t)},fetchFilterMetadata:function(){var e=this;t.ajax({url:this.url+".json",type:"OPTIONS",data:{_method:"OPTIONS"},success:function(t){e.generateFilterSchema(t.filters)}})},generateFilterSchema:function(t){var e,i;this.filterSchema={};for(e in t)i=t[e],this.filterSchema[e]={type:this.dataTypes[i.type]||"Text",title:i.label||e},-1!=i.type.indexOf("json")&&(this.filterSchema[e].validators=[this.validatorFunction]);this.trigger("filter-form-updated",this.filterSchema)},getTitle:function(){return this.title},getDataType:function(){return this.dataType},getModelType:function(){return this.overlayType},getFields:function(){return this.fields},getIsCustomType:function(){return this.isCustomType},getIsSite:function(){return this.isSite},getIsMedia:function(){return this.isMedia},getModel:function(t){var e=this.get(t);return e||(e=this.createNewModel()),e},createNewModel:function(){var t=new(0,this.model);return t.collection=this,t.set("overlay_type",this.getModelType()),t.set("project_id",this.projectID),this.isCustomType&&t.set("fields",this.fields.toJSON()),t}}}),define("collections/basePageable",["underscore","backbone-pageable","collections/baseMixin"],function(t,e,i){"use strict";var n=e.extend({initialize:function(i,n){n=n||{},t.extend(this,n),e.prototype.initialize.apply(this,arguments)},fillColor:"#ed867d",size:23,events:{"click #toolbar-search":"doSearch","click #toolbar-clear":"clearSearch"},state:{currentPage:1,pageSize:150,sortKey:"id",order:-1},queryParams:{totalPages:null,totalRecords:null,sortKey:"ordering",pageSize:"page_size",currentPage:"page"},parseState:function(t,e,i,n){return{totalRecords:t.count}},parseRecords:function(t,e){return t.results},doSearch:function(t,e){this.query+="WHERE name like %"+t+"% OR caption like %"+t+"% OR attribution like %"+t+"% OR owner like %"+t+"% OR tags contains ("+t+")",this.fetch({reset:!0})},clearSearch:function(t){this.query="",this.fetch({reset:!0})}});return t.extend(n.prototype,i),t.extend(n.prototype,{fetch:function(t){return t=t||{},t.data=t.data||{},this.projectID&&(t.data={project_id:this.projectID}),this.query&&(t.data.query=this.query),e.prototype.fetch.call(this,t)}}),n}),define("collections/projectUsers",["models/projectUser","collections/basePageable"],function(t,e){"use strict";return e.extend({model:t,name:"ProjectUsers",initialize:function(t,i){i.id?(this.url="/api/0/projects/"+i.id+"/users/",e.prototype.initialize.apply(this,arguments)):alert("The ProjectUsers collection requires a url parameter upon initialization")}})}),define("models/project",["underscore","models/base","models/projectUser","collections/projectUsers"],function(t,e,i,n){"use strict";return e.extend({defaults:t.extend({},e.prototype.defaults,{isActive:!1,isVisible:!1,checked:!1}),urlRoot:"/api/0/projects/",initialize:function(t,i){this.get("id")&&(this.projectUsers=new n(null,{id:this.get("id")})),e.prototype.initialize.apply(this,arguments)},shareWithUser:function(t,e,n){var r=new i(null,{id:this.get("id")}),s=this;r.set("user",t),r.set("authority",e),r.save(null,{success:function(){s.getProjectUsers()},error:n})},getProjectUserCount:function(){return this.projectUsers.length},getProjectUsers:function(){this.projectUsers.fetch({reset:!0})},getProjectUserByUsername:function(t){var e,i;for(e=0;e<this.projectUsers.length;e++)if(i=this.projectUsers.at(e),i.get("user")===t)return i;return null}})}),define("collections/base",["underscore","backbone","collections/baseMixin"],function(t,e,i){"use strict";var n=e.Collection.extend({key:null,getDataType:function(){return this.key},fillColor:"#ed867d",size:23,defaults:{isVisible:!0},initialize:function(e,i){t.extend(this,i)},parse:function(t){return t.results}});return t.extend(n.prototype,i),n}),define("collections/projects",["models/project","collections/base","collections/basePageable"],function(t,e,i){"use strict";return i.extend({model:t,name:"Projects",key:"projects",overlay_type:"project",url:"/api/0/projects/"})}),define("text!apps/home/templates/project-list.html",[],function(){return'<div class="container-search">\n\t<div class="container-center">\n\t\t<div class="row">\n\t\t    <form class="search-form">\n\t\t        <input id="searchTerm" type="text" placeholder="Search Projects" value="{{ searchTerm }}">\n\t\t        <button id="search">\n\t\t\t        <i class="fa fa-search" aria-hidden="true"></i>\n\t\t\t    </button>\n\t\t    </form>\n\t\t\t\t\x3c!--This button normally leads to add new project, but will be used for the share-form html and js--\x3e\n\t\t    <button class="button-primary button-main-action click-to-open button-wide" data-modal="modal-new-map" id="add-project">New Project</button>\n\t\t</div>\n\t</div>\n</div>\n\n\n<div class="container-projects">\n\t<div class = "container-center" id="gallery-main">\n    \t\x3c!--project data inserted here --\x3e\n    </div>\n</div>'}),define("text!apps/home/templates/share-form.html",[],function(){return'\x3c!--Global template helper variables go here before HTML structure--\x3e\n\n<div class="inline-form">\n    <label for="projectName">Title: </label>\n    <input type="text" placeholder="Type name of project" id="projectName" value="{{name}}">\n</div>\n<div class="inline-form">\n    <label for="projectName">Description: </label>\n    <textarea placeholder="Type description of project" id="caption">{{ caption }}</textarea>\n</div>\n<div class="inline-form projectName">\n    <label for="projectName">Tags: </label>\n    <input type="text" placeholder="put some tags for easy search" id="tags" value="{{ tags }}">\n</div>\n\n<div class = "inline-form slug {{#if slugError}}error{{/if}}">\n    <label>Friendly URL:</label>\n    <input id="slug" type="text" value="{{ slug }}" placeholder="put name or leave blank for autofill">\n</div>\n{{#if slugError}}\n    <p class="errorMessage">{{slugError}}</p>\n{{/if}}\n\n<div class = "inline-form share_type">\n    <label for="share_type">Sharing Permissions:</label>\n    <div id="share_type" class = "container-3-4">\n        <select id="access_authority">\n            <option value="1" {{#ifequal access_authority 1}} SELECTED {{/ifequal}}>Private</option>\n            <option value="3" {{#ifequal access_authority 3}} SELECTED {{/ifequal}}>Public</option>\n        </select>\n    </div>\n</div>\n<div  class="inline-form">\n    <div class="container-1-4">\n    </div>\n    <div class="container-3-4">\n        <div id="userTableDiv">\n            <table class="userTable">\n                <thead>\n                    <tr>\n                        <th>User</th>\n                        <th>Role</th>\n                        <th></th>\n                    </tr>\n                </thead>\n                <tbody id="userList"></tbody>\n            </table>\n        </div>\n        <div id="addNewUser">\n            <a class="new_user_button button-tertiary"><i class="fa fa-plus add" aria-hidden="true"></i>Add new user</a>\n        </div>\n    </div>\n</div>\n\n{{#if projectSaveSuccess}}\n    <p class="projectSaveSuccess successMessage">{{projectSaveSuccess}}</p>\n{{/if}}\n'}),define("apps/home/views/main",["marionette","underscore","handlebars","apps/home/views/projectItemView","collections/projects","models/project","text!../templates/project-list.html","text!../templates/share-form.html"],function(t,e,i,n,r,s,o,a){"use strict";return t.CompositeView.extend({childView:n,searchTerm:null,childViewContainer:"#gallery-main",events:{"click .close":"hideModal","click #add-project":"showModal","click #search":"doSearch","click #confirm-add":"confirmAdd"},childViewOptions:function(){return{app:this.app}},hideModal:function(){this.$el.find("#share-modal").get(0).style.display="none"},showModal:function(){this.app.vent.trigger("share-project",{model:null})},confirmAdd:function(){var t=new s;t.set("name",this.$el.find("#name").val()),t.set("caption",this.$el.find("#caption").val()),t.set("tags",this.$el.find("#tags").val()),t.set("slug",this.$el.find("#slug").val()),t.set("access_authority",this.$el.find("#access_authority").val()),t.save(),this.listenTo(t,"sync",this.displayProjects),document.getElementById("share-modal").style.display="none"},template:i.compile(o),initialize:function(i){e.extend(this,i),t.CompositeView.prototype.initialize.call(this),this.displayProjects(),this.listenTo(this.app.vent,"search-requested",this.doSearch),this.listenTo(this.app.vent,"clear-search",this.clearSearch),this.listenTo(this.app.vent,"project-added",this.displayProjects)},hideLoadingMessage:function(){this.$el.find(this.childViewContainer).empty()},getDefaultQueryString:function(){return""},templateHelpers:function(){return{searchTerm:this.searchTerm}},doSearch:function(t){t.preventDefault();var e=this.$el.find("#searchTerm").val(),i="WHERE name like %"+e+"% OR caption like %"+e+"% OR owner like %"+e+"% OR tags contains ("+e+")";this.searchTerm=e,this.collection.query=i,this.collection.fetch({reset:!0})},clearSearch:function(t){this.collection.query=this.getDefaultQueryString(),this.collection.fetch({reset:!0}),t.preventDefault()},displayProjects:function(){this.collection=new r,this.collection.fetch({reset:!0}),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"remove",this.render)}})}),define("text!apps/home/templates/toolbar.html",[],function(){return'<a class="logotype" href="/">Local Ground</a>\n<ul class="right-nav">\n    <li>\n        <a href="/about">About</a>\n    </li>\n    <li>\n        <a href="/documentation">How it works</a>\n    </li>\n    <li>\n        <a class="account" id="toggle-button">\n            <i class="fa fa-caret-down" aria-hidden="true"></i>\n            {{ username }}\n        </a>\n        <div class="dropdown-menu" style="display:none;" id="account-options">\n            <a href="/accounts/logout/">Logout</a>\n        </div>\n    </li>\n</ul>\n'}),define("apps/home/views/toolbar",["underscore","handlebars","marionette","text!../templates/toolbar.html"],function(t,e,i,n){"use strict";return i.ItemView.extend({template:e.compile(n),events:{"click #toggle-button":"toggleVisibility"},templateHelpers:function(){return{username:this.app.username,user:this.app.user}},initialize:function(e){t.extend(this,e),i.ItemView.prototype.initialize.call(this),this.render()},toggleVisibility:function(){this.$el.find(".dropdown-menu").toggle()}})}),define("text!apps/home/templates/project-user-item.html",[],function(){return'<td>\n    {{#if user }}\n        <span class="username">{{user}}</span>\n    {{else}}\n        <input type="text" class="username" placeholder="username" value="{{ user }}"></td>\n    {{/if}}\n<td>\n    <select class="authority">\n        <option value>Select One</option>\n        <option value= "1" {{#ifequal authority 1}} SELECTED {{/ifequal}}>Can View</option>\n        <option value= "2" {{#ifequal authority 2}} SELECTED {{/ifequal}}>Can Edit</option>\n        <option value= "3" {{#ifequal authority 3}} SELECTED {{/ifequal}}>Can Manage</option>\n    </select>\n</td>\n<td><a href="#" class="delete-project-user">&times;</a></td>\n'}),define("apps/home/views/projectUserView",["jquery","marionette","underscore","handlebars","text!../templates/project-user-item.html"],function(t,e,i,n,r){"use strict";return e.ItemView.extend({initialize:function(t){i.extend(this,t)},events:{"click .delete-project-user":"doDelete"},template:n.compile(r),tagName:"tr",doDelete:function(t){confirm("Are you sure you want to remove this user from the project?")&&(this.model.destroy(),t.preventDefault())}})}),define("apps/home/views/shareForm",["jquery","marionette","underscore","handlebars","text!../templates/share-form.html","text!../templates/project-user-item.html","models/project","collections/projectUsers","apps/home/views/projectUserView","jquery.ui"],function(t,e,i,n,r,s,o,a,l){"use strict";return e.CompositeView.extend({childViewContainer:"#userList",template:n.compile(r),events:{"click .new_user_button":"addUserButton","click .delete-project-user":"removeRow","blur #projectName":"generateSlug"},slugError:null,initialize:function(t){i.extend(this,t),void 0==this.model?this.model=new o:(this.collection=this.model.projectUsers,e.CompositeView.prototype.initialize.call(this),this.model.getProjectUsers(),this.attachCollectionEventHandlers()),this.render()},childViewOptions:function(){return this.model.toJSON()},generateSlug:function(){if(!(this.$el.find("#slug").val().length>0)){var t=this.$el.find("#projectName").val().toLowerCase().split(" ");for(var e in t)t[e]=t[e].replace(/\W+/g,"").trim();var i=t.join(" ").trim().replace(/\s+/g,"-");this.$el.find("#slug").val(i)}},childView:l,attachCollectionEventHandlers:function(){this.listenTo(this.collection,"add",this.render),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"destroy",this.render)},fetchShareData:function(){this.model.getProjectUsers()},removeRow:function(e){t(e.target).parent().parent().remove(),this.checkNumberOfRows()},onRender:function(){this.checkNumberOfRows()},templateHelpers:function(){var t={username:this.app.username};return this.model&&this.model.projectUsers&&(t.projectUsers=this.model.projectUsers.toJSON()),t.slugError=this.slugError,t},saveProjectSettings:function(){var t=this.$el.find("#projectName").val(),e=this.$el.find("#access_authority").val(),i=this.$el.find("#caption").val(),n=this.$el.find("#slug").val(),r=this.$el.find("#tags").val();this.blankInputs()?console.log("required items not filled: Need Name, Owner, and User"):(this.model.set("name",t),this.model.set("access_authority",e),this.model.set("tags",r),this.model.set("caption",i),this.model.set("slug",this.setSlugValue(n)),this.model.set("owner",this.app.username),this.model.save(null,{success:this.handleServerSuccess.bind(this),error:this.handleServerError.bind(this)}))},redirectToMapPage:function(t){window.location.assign(window.location.href+"data/?project_id="+t+"#/map")},handleServerSuccess:function(t,e){this.createNewProjectUsers(),this.slugError=null;var i=this.model.id;this.render(),this.redirectToMapPage(i)},handleServerError:function(t,e){console.log("Project Not Saved / Created"),this.app.vent.trigger("error-message","Project Not Saved. Errors detected.");var i=JSON.parse(e.responseText);i.slug&&i.slug.length>0&&(this.slugError=i.slug[0]),this.render()},setSlugValue:function(t){var e=t.toLowerCase().split(" ").join("_");return""!=e?e:"slug_"+parseInt(1e5*Math.random(),10)},createNewProjectUsers:function(){var e,i,n,r,s,o,l=this.$el.find("#userList").children();for(this.collection||(this.model.projectUsers=new a(null,{id:this.model.get("id")}),this.collection=this.model.projectUsers,this.attachCollectionEventHandlers()),e=0;e<l.length;e++)if((i=t(l[e])).css("background-color","#FFFFFF"),s=parseInt(i.find(".authority").val(),10),i.attr("id")==this.model.id){if(n=i.find(".username").html(),o=this.model.getProjectUserByUsername(n),!s)return void i.css("background-color","#FFAAAA");o.set("authority",s),o.save()}else{if(n=i.find(".username").val(),r=i.find(".username"),!s||""==n.trim()||void 0==n)return i.css("background-color","#FFAAAA"),void this.errorUserName(r);this.model.shareWithUser(n,s,function(t,e){var n=JSON.parse(e.responseText);console.log(t,e),console.log(e.responseText.user),i.css("background-color","#FFAAAA"),i.css("color","#AA0000"),i.find("td")[0].append(n.user)})}this.app.vent.trigger("project-added")},addUserButton:function(){var e=this.$el.find(".userTable"),i=t("<tr class='new-row'></tr>"),r=n.compile(s);e.show(),i.append(r()),this.$el.find("#userList").append(i),this.initAutoComplete(i.find(".username")),this.checkNumberOfRows()},initAutoComplete:function(e){e.autocomplete({minLength:0,source:function(e,i){new RegExp(t.ui.autocomplete.escapeRegex(e.term),"i");t.ajax({url:"/api/0/usernames/",dataType:"json",data:{q:e.term},success:function(t){i(t)}})}})},blankInputs:function(){var e=!1,i=this.$el.find("#projectName").val(),n=this.$el.find("#access_authority").val();this.$el.find("#slug").val();return this.$el.find("#projectName").prev().css("color","#000000"),this.$el.find("#access_authority").prev().css("color","#000000"),t.trim(i)||(e=!0,this.$el.find("#projectName").prev().css("color","#FF0000")),n||(e=!0,this.$el.find("#access_authority").prev().css("color","#FF0000")),e},deleteProject:function(){var t=this;confirm("Are you sure you want to delete this project?")&&this.model.destroy({success:function(){console.log(t.app.vent),t.app.vent.trigger("hide-modal")}})},errorUserName:function(t){try{if(""==t.val().trim()||void 0==t.val())throw"username missing"}catch(e){t.attr("placeholder",e),t.css("background-color","#FFDDDD")}},checkNumberOfRows:function(){var t=this.$el.find("#userList"),e=this.$el.find("#userTableDiv"),i=t.children().length;i>0||void 0==i||null==i?e.show():e.hide()}})}),define("text!lib/modals/modal.html",[],function(){return'<div class="modal">\n    <div class="modal-content" style="width: {{ width }};">\n        <header>\n          <span class="close">&times;</span>\n          <h1>{{ title }}</h1>\n        </header>\n        <div class="modal-body" style="height: {{ height }};">\n            \x3c!-- view content injectsed here --\x3e\n        </div>\n        <footer>\n            <div class="buttons">\n\n                {{#if showDeleteButton}}\n                    <button class="delete-modal button-secondary">{{ deleteButtonText }}</button>\n                {{else}}\n                    <button class="close-modal button-secondary">{{ closeButtonText }}</button>\n                {{/if}}\n                {{#if showSaveButton}}\n                    <button class="save-modal-form button-primary">{{ saveButtonText }}</button>\n                {{/if}}\n            </div>\n        </footer>\n    </div>\n</div>\n'}),define("lib/modals/modal",["jquery","underscore","marionette","handlebars","text!../modals/modal.html"],function(t,e,i,n,r){"use strict";return i.LayoutView.extend({view:null,title:null,width:"90vw",height:"70vh",margin:"auto",showCloseButton:!0,closeButtonText:"Cancel",saveButtonText:"Save",deleteButtonText:"Delete",printButtonText:"Print",showSaveButton:!0,showDeleteButton:!0,regions:{modalBodyRegion:".modal-body"},events:{"click .close":"hide","click .close-modal":"hide","click .save-modal-form":"saveFunction","click .delete-modal":"deleteFunction"},template:n.compile(r),initialize:function(i){i=i||{},e.extend(this,i),this.saveFunction=function(){i.saveFunction(),this.render()},t(".modal").get(0)?(this.$el=t("<div></div>").append(t(".modal")),t("body").append(this.$el)):(this.render(),t("body").append(this.$el)),this.attachEvents(),this.appendView()},templateHelpers:function(){return{title:this.title,width:this.width,height:this.height,showSaveButton:this.showSaveButton,showDeleteButton:this.showDeleteButton,closeButtonText:this.closeButtonText,saveButtonText:this.saveButtonText,deleteButtonText:this.deleteButtonText,printButtonText:this.printButtonText}},appendView:function(){this.view&&this.modalBodyRegion.show(this.view)},attachEvents:function(){this.app&&(console.log("adding listener..."),this.listenTo(this.app.vent,"update-modal-save-button",this.updateSaveButton))},update:function(t){t.closeButtonText=t.closeButtonText||"Cancel",t.saveButtonText=t.saveButtonText||"Save",t.deleteButtonText=t.deleteButtonText||"Delete",t.printButtonText=t.printButtonText||"Print",e.extend(this,t),this.saveFunction=function(){t.saveFunction()},this.attachEvents(),this.render(),this.delegateEvents(),this.appendView()},updateSaveButton:function(t){this.$el.find(".save-modal-form").css(t),t.printButtonText&&this.$el.find(".save-modal-form").html(t.printButtonText)},setSize:function(){this.$el.find(".modal-content").css("width",this.width),this.$el.find(".modal-body").css("height",this.height)},createModal:function(){this.$el=t(this.template({title:this.title})),t("body").append(this.$el)},show:function(){this.$el.find(".modal").show(),this.$el.css("display","block")},hide:function(){this.$el.find(".modal").hide(),this.render()}})}),define("lib/appUtilities",["jquery"],function(t){"use strict";return{addMessageListeners:function(){this.listenTo(this.vent,"success-message",this.showSuccessMessage),this.listenTo(this.vent,"warning-message",this.showWarningMessage),this.listenTo(this.vent,"error-message",this.showFailureMessage)},saveState:function(t,e,i){this.saveToLocalStorage(t,e,i)},restoreState:function(t){return this.getFromLocalStorage(t)},getFromLocalStorage:function(t){var e=localStorage.mapplication;if(!e)return null;try{e=JSON.parse(e)}catch(t){return null}return e[t]},saveToLocalStorage:function(e,i,n){var r=localStorage.mapplication;(r=r?JSON.parse(r):{})[e]=r[e]||{},n?r[e]=i:t.extend(r[e],i),localStorage.mapplication=JSON.stringify(r)},setMap:function(t){this.map=t},getMap:function(){return this.map},setMode:function(t){this.mode=t,this.vent.trigger("mode-change")},getMode:function(){return this.mode},setOverlayView:function(t){this.overlayView=t},getOverlayView:function(){return this.overlayView},csrfSafeMethod:function(t){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(t)},sameOrigin:function(t){var e="//"+document.location.host,i=document.location.protocol+e;return t==i||t.slice(0,i.length+1)==i+"/"||t==e||t.slice(0,e.length+1)==e+"/"||!/^(\/\/|http:|https:).*/.test(t)},setCsrfToken:function(t,e){if(!this.csrfSafeMethod(e.type)&&this.sameOrigin(e.url)){var i=this.getCookie("csrftoken");t.setRequestHeader("X-CSRFToken",i),t.setRequestHeader("HTTP_X_CSRFTOKEN",i)}},getCookie:function(e){var i,n,r,s;if(document.cookie&&""!=document.cookie)for(n=document.cookie.split(";"),r=0;r<n.length;r++)if((s=t.trim(n[r])).substring(0,e.length+1)==e+"="){i=decodeURIComponent(s.substring(e.length+1));break}return i},getProjectFromParam:function(){var t=this.getParameterByName("project_id");return t?this.projects.get(t):null},getProjectFromLocalStorage:function(){var t=this.restoreState("project_id");return t?this.projects.get(t):null},getProjectID:function(){var t=this.getParameterByName("project_id");return t?this.setProjectID(t):t=this.restoreState("project_id"),t||(console.log("You're not logged in. Redirecting to: /"),!1)},setProjectID:function(t){this.saveState("project_id",t,!0)},selectProject:function(){this.selectedProject=this.getProjectFromParam(),this.selectedProject||(this.selectedProject=this.getProjectFromLocalStorage()),this.selectedProject||(this.selectedProject=this.projects.at(0)),this.selectedProject?this.saveState("project_id",this.selectedProject.id,!0):(console.log("You're not logged in. Redirecting..."),window.location=window.location.host+"/accounts/login/?next="+window.location)},showLoadingMessage:function(){},hideLoadingMessage:function(){},handleDatabaseError:function(t,e){var i,n="";try{i=JSON.parse(e.responseText),n=i.non_field_errors[0]}catch(t){n="Unknown error"}this.vent.trigger("database-error",{message:n})},showSuccessMessage:function(e){console.log("Success Message Called"),0==t(".success-message").length&&t("body").append(t('<div class="success-message"></div>')),t(".success-message").html(e).fadeIn(200).delay(3e3).fadeOut(1500)},showFailureMessage:function(e){0==t(".failure-message").length&&t("body").append(t('<div class="failure-message"></div>')),t(".failure-message").html(e).fadeIn(200).delay(3e3).fadeOut(1500)},showWarningMessage:function(e){0==t(".warning-message").length&&t("body").append(t('<div class="warning-message"></div>')),t(".warning-message").html(e).fadeIn(200).delay(3e3).fadeOut(1500)},initAJAX:function(e){console.log("init ajax");var i=this;t.ajaxSetup({beforeSend:function(t,e){i.showLoadingMessage(),i.setCsrfToken(t,e)},complete:this.hideLoadingMessage,statusCode:{400:i.handleDatabaseError.bind(this,e),401:i.handleDatabaseError.bind(this,e),500:i.handleDatabaseError.bind(this,e)}})},getParameterByName:function(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}}}),define("lib/handlebars-helpers",["handlebars"],function(t){"use strict";t.registerHelper("ifHasQuotes",function(t,e){return!(!t||-1==t.indexOf('"'))&&e.fn(this)}),t.registerHelper("ifequal",function(t,e,i){if(arguments.length<3)throw new Error("Handlebars Helper equal needs 2 parameters");return t!=e?i.inverse(this):i.fn(this)}),t.registerHelper("ifcontains",function(t,e,i){if(-1!=t.indexOf(e))return i.fn(this)}),t.registerHelper("ifnotequal",function(t,e,i){if(arguments.length<3)throw new Error("Handlebars Helper equal needs 2 parameters");return t==e?i.inverse(this):i.fn(this)}),t.registerHelper("ifnot",function(t,e){if(arguments.length<2)throw new Error("Handlebars Helper ifnot needs 1 parameter");return t?e.inverse(this):e.fn(this)}),t.registerHelper("compare",function(t,e,i){if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");var n=i.hash.operator||"==",r={"==":function(t,e){return t==e},"===":function(t,e){return t===e},"!=":function(t,e){return t!=e},"<":function(t,e){return t<e},">":function(t,e){return t>e},"<=":function(t,e){return t<=e},">=":function(t,e){return t>=e},typeof:function(t,e){return typeof t==e}};if(!r[n])throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+n);return r[n](t,e)?i.fn(this):i.inverse(this)}),t.registerHelper("truncate",function(e,i){if(e){if(e.length>i&&e.length>0){var n=e+" ";return n=e.substr(0,i),n=e.substr(0,n.lastIndexOf(" ")),n=n.length>0?n:e.substr(0,i),new t.SafeString(n+"...")}return e}}),t.registerHelper("hexToRgb",function(t,e){var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return(i=i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null)?"rgba("+i.r+", "+i.g+", "+i.b+", "+e+")":""}),t.registerHelper("highlightIntensity",function(e){var i,n=/(d+):/i,r=e.match(n);return console.log(r),e?(-1!=e.indexOf("1:")?i="#F6FEAA":-1!=e.indexOf("2:")?i="#F7F8A4":-1!=e.indexOf("3:")?i="#F9F29F":-1!=e.indexOf("4:")?i="#FAEC99":-1!=e.indexOf("5:")&&(i="#FCE694"),new t.SafeString('style="background-color: '+i+'"')):""}),t.registerHelper("times",function(t,e,i){var n,r="";for(n=t;n<e;++n)r+=i.fn(n);return r}),t.registerHelper("repeat",function(t,e){if(!t)return"";var i,n,r=t.match(/(\d+):/i),s="";if(r&&r.length>1)for(i=r[1],n=0;n<i;n++)s+='<i class="fa '+e+'"></i>&nbsp;';return s}),t.registerHelper("paginator",function(){var t=/page=(\d+)/i,e=null,i=null,n="";return this.previous&&(e=this.previous.match(t)),this.next&&(i=this.next.match(t)),e&&e.length>1&&(n+='<button class="btn page" style="margin-right:10px" page-num="'+e[1]+'"><i class="fa fa-angle-double-left"></i> previous</button>'),i&&i.length>1&&(n+='<button class="btn page" page-num="'+i[1]+'">next <i class="fa fa-angle-double-right"></i></button>'),n})}),define("apps/home/home-app",["marionette","backbone","apps/home/router","apps/home/views/main","apps/home/views/toolbar","apps/home/views/shareForm","lib/modals/modal","lib/appUtilities","lib/handlebars-helpers"],function(t,e,i,n,r,s,o,a){"use strict";return t.Application.extend(_.extend(a,{regions:{projectRegion:".main-panel",toolbarMainRegion:"#toolbar-main",shareFormRegion:"#share-form"},modal:null,start:function(n){t.Application.prototype.start.apply(this,[n]),this.initAJAX(n),this.router=new i({app:this}),e.history.start()},initialize:function(e){_.extend(this,e),this.username=username,t.Application.prototype.initialize.apply(this,[e]),this.loadRegions(),this.modal=new o,this.listenTo(this.vent,"share-project",this.showShareForm),this.listenTo(this.vent,"hide-modal",this.hideShareForm),this.addMessageListeners()},loadRegions:function(){this.showProjectList(),this.showToolbar()},showShareForm:function(t){var e=new s({app:this,model:t.model}),i=t.model&&t.model.get("name")?"Update "+t.model.get("name")+" Settings":"Create New Project";this.modal.update({view:e,title:i,width:500,saveFunction:e.saveProjectSettings.bind(e),showDeleteButton:null!=t.model,deleteFunction:e.deleteProject.bind(e)}),this.modal.show()},hideShareForm:function(){console.log("hideShareForm"),this.modal.hide()},showToolbar:function(){this.toolbarView=new r({app:this}),this.toolbarMainRegion.show(this.toolbarView)},showProjectList:function(){this.mainView=new n({app:this}),this.projectRegion.show(this.mainView)}}))});var configPath=(configPath||"")+"require-config";require([configPath],function(){"use strict";require(["jquery","apps/home/home-app"],function(t,e){t(function(){(new e).start()})})}),define("apps/home/kickoff",function(){});